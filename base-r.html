<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>R Training: The new Excel, and more</title>
  <meta name="description" content="This resource is an introduction to the R programming language. It can be used as standalone learning tool, or as part of training sessions.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="R Training: The new Excel, and more" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This resource is an introduction to the R programming language. It can be used as standalone learning tool, or as part of training sessions." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R Training: The new Excel, and more" />
  
  <meta name="twitter:description" content="This resource is an introduction to the R programming language. It can be used as standalone learning tool, or as part of training sessions." />
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="general-coding.html">
<link rel="next" href="graphs.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introductory R Training</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="getting-started-with-rstudio.html"><a href="getting-started-with-rstudio.html"><i class="fa fa-check"></i><b>1</b> Getting Started with RStudio</a><ul>
<li class="chapter" data-level="1.1" data-path="getting-started-with-rstudio.html"><a href="getting-started-with-rstudio.html#opening-r-studio"><i class="fa fa-check"></i><b>1.1</b> Opening R Studio</a></li>
<li class="chapter" data-level="1.2" data-path="getting-started-with-rstudio.html"><a href="getting-started-with-rstudio.html#r-studio-layout"><i class="fa fa-check"></i><b>1.2</b> R Studio Layout</a></li>
<li class="chapter" data-level="1.3" data-path="getting-started-with-rstudio.html"><a href="getting-started-with-rstudio.html#setting-up-a-project"><i class="fa fa-check"></i><b>1.3</b> Setting up a project</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>2</b> Data</a></li>
<li class="chapter" data-level="3" data-path="general-coding.html"><a href="general-coding.html"><i class="fa fa-check"></i><b>3</b> General Coding</a><ul>
<li class="chapter" data-level="3.1" data-path="general-coding.html"><a href="general-coding.html#objects"><i class="fa fa-check"></i><b>3.1</b> Objects</a></li>
<li class="chapter" data-level="3.2" data-path="general-coding.html"><a href="general-coding.html#comments"><i class="fa fa-check"></i><b>3.2</b> Comments</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="base-r.html"><a href="base-r.html"><i class="fa fa-check"></i><b>4</b> Base R</a><ul>
<li class="chapter" data-level="4.1" data-path="base-r.html"><a href="base-r.html#loading-in-data"><i class="fa fa-check"></i><b>4.1</b> Loading in data</a></li>
<li class="chapter" data-level="4.2" data-path="base-r.html"><a href="base-r.html#basic-dataframe-functions"><i class="fa fa-check"></i><b>4.2</b> Basic dataframe functions</a></li>
<li class="chapter" data-level="4.3" data-path="base-r.html"><a href="base-r.html#selecting-certain-columnsremoving-columns"><i class="fa fa-check"></i><b>4.3</b> Selecting certain columns/removing columns</a></li>
<li class="chapter" data-level="4.4" data-path="base-r.html"><a href="base-r.html#conditional-selections"><i class="fa fa-check"></i><b>4.4</b> Conditional Selections</a></li>
<li class="chapter" data-level="4.5" data-path="base-r.html"><a href="base-r.html#altering-data-in-dataframes"><i class="fa fa-check"></i><b>4.5</b> Altering data in dataframes</a></li>
<li class="chapter" data-level="4.6" data-path="base-r.html"><a href="base-r.html#writing-data"><i class="fa fa-check"></i><b>4.6</b> Writing data</a></li>
<li class="chapter" data-level="4.7" data-path="base-r.html"><a href="base-r.html#packages"><i class="fa fa-check"></i><b>4.7</b> Packages</a></li>
<li class="chapter" data-level="4.8" data-path="base-r.html"><a href="base-r.html#the-pipe"><i class="fa fa-check"></i><b>4.8</b> The pipe</a></li>
<li class="chapter" data-level="4.9" data-path="base-r.html"><a href="base-r.html#joining"><i class="fa fa-check"></i><b>4.9</b> Joining</a></li>
<li class="chapter" data-level="4.10" data-path="base-r.html"><a href="base-r.html#selecting"><i class="fa fa-check"></i><b>4.10</b> Selecting</a></li>
<li class="chapter" data-level="4.11" data-path="base-r.html"><a href="base-r.html#pivoting"><i class="fa fa-check"></i><b>4.11</b> Pivoting</a></li>
<li class="chapter" data-level="4.12" data-path="base-r.html"><a href="base-r.html#filtering"><i class="fa fa-check"></i><b>4.12</b> Filtering</a></li>
<li class="chapter" data-level="4.13" data-path="base-r.html"><a href="base-r.html#mutating"><i class="fa fa-check"></i><b>4.13</b> Mutating</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>5</b> Graphs</a><ul>
<li class="chapter" data-level="5.1" data-path="graphs.html"><a href="graphs.html#ggplot2"><i class="fa fa-check"></i><b>5.1</b> ggplot2</a></li>
<li class="chapter" data-level="5.2" data-path="graphs.html"><a href="graphs.html#scatter-plots"><i class="fa fa-check"></i><b>5.2</b> Scatter plots</a></li>
<li class="chapter" data-level="5.3" data-path="graphs.html"><a href="graphs.html#bar-charts"><i class="fa fa-check"></i><b>5.3</b> Bar charts</a></li>
<li class="chapter" data-level="5.4" data-path="graphs.html"><a href="graphs.html#line-graphs"><i class="fa fa-check"></i><b>5.4</b> Line graphs</a></li>
<li class="chapter" data-level="5.5" data-path="graphs.html"><a href="graphs.html#displaying-a-third-variable"><i class="fa fa-check"></i><b>5.5</b> Displaying a third variable</a></li>
<li class="chapter" data-level="5.6" data-path="graphs.html"><a href="graphs.html#styles"><i class="fa fa-check"></i><b>5.6</b> Styles</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="statistical-operations.html"><a href="statistical-operations.html"><i class="fa fa-check"></i><b>6</b> Statistical Operations</a><ul>
<li class="chapter" data-level="6.1" data-path="statistical-operations.html"><a href="statistical-operations.html#maximum-minimum-and-range"><i class="fa fa-check"></i><b>6.1</b> Maximum, Minimum, and Range</a></li>
<li class="chapter" data-level="6.2" data-path="statistical-operations.html"><a href="statistical-operations.html#averages"><i class="fa fa-check"></i><b>6.2</b> Averages</a></li>
<li class="chapter" data-level="6.3" data-path="statistical-operations.html"><a href="statistical-operations.html#correlations"><i class="fa fa-check"></i><b>6.3</b> Correlations</a></li>
<li class="chapter" data-level="6.4" data-path="statistical-operations.html"><a href="statistical-operations.html#significance-testing"><i class="fa fa-check"></i><b>6.4</b> Significance Testing</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="iteration.html"><a href="iteration.html"><i class="fa fa-check"></i><b>7</b> Iteration</a><ul>
<li class="chapter" data-level="7.1" data-path="iteration.html"><a href="iteration.html#if"><i class="fa fa-check"></i><b>7.1</b> if</a></li>
<li class="chapter" data-level="7.2" data-path="iteration.html"><a href="iteration.html#for-loops"><i class="fa fa-check"></i><b>7.2</b> for loops</a></li>
<li class="chapter" data-level="7.3" data-path="iteration.html"><a href="iteration.html#while-loops"><i class="fa fa-check"></i><b>7.3</b> while loops</a></li>
<li class="chapter" data-level="7.4" data-path="iteration.html"><a href="iteration.html#how-could-we-use-loops"><i class="fa fa-check"></i><b>7.4</b> How could we use loops?</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>8</b> Maps</a><ul>
<li class="chapter" data-level="8.1" data-path="maps.html"><a href="maps.html#loading-in-geospatial-data"><i class="fa fa-check"></i><b>8.1</b> Loading in geospatial data</a></li>
<li class="chapter" data-level="8.2" data-path="maps.html"><a href="maps.html#coordinate-systems"><i class="fa fa-check"></i><b>8.2</b> Coordinate systems</a></li>
<li class="chapter" data-level="8.3" data-path="maps.html"><a href="maps.html#transforming-mapping-data"><i class="fa fa-check"></i><b>8.3</b> Transforming mapping data</a></li>
<li class="chapter" data-level="8.4" data-path="maps.html"><a href="maps.html#point-maps"><i class="fa fa-check"></i><b>8.4</b> Point maps</a></li>
<li class="chapter" data-level="8.5" data-path="maps.html"><a href="maps.html#chloropleth-maps"><i class="fa fa-check"></i><b>8.5</b> Chloropleth maps</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>9</b> R Markdown</a><ul>
<li class="chapter" data-level="9.1" data-path="r-markdown.html"><a href="r-markdown.html#text"><i class="fa fa-check"></i><b>9.1</b> Text</a></li>
<li class="chapter" data-level="9.2" data-path="r-markdown.html"><a href="r-markdown.html#code"><i class="fa fa-check"></i><b>9.2</b> Code</a></li>
<li class="chapter" data-level="9.3" data-path="r-markdown.html"><a href="r-markdown.html#multiple-reports"><i class="fa fa-check"></i><b>9.3</b> Multiple Reports</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>10</b> Functions</a><ul>
<li class="chapter" data-level="10.1" data-path="functions.html"><a href="functions.html#writing-functions"><i class="fa fa-check"></i><b>10.1</b> Writing functions</a></li>
<li class="chapter" data-level="10.2" data-path="functions.html"><a href="functions.html#applying-functions-repetitively"><i class="fa fa-check"></i><b>10.2</b> Applying functions repetitively</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Training: The new Excel, and more</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="base-r" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Base R</h1>
<p>R comes with a number of functions that allow you to maniuplate, summarise and analyse data. Collectively these are known as <strong>Base R</strong>.</p>
<p>This chapter summarises some of the core functions for manipulating data in base R.</p>
<div id="loading-in-data" class="section level2">
<h2><span class="header-section-number">4.1</span> Loading in data</h2>
<p>The most common process to load in data is to load in a CSV file.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co">#Load in data</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">swfc_<span class="dv">16</span>_init &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/SWFC_2016_Machine_Readable.csv&quot;</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">swfc_<span class="dv">16</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span>_init</a></code></pre></div>
<div class="tip">
<p><b>Tip:</b>
Load in and create and initial, raw version of the file, and never do anything to that object. This means if you muck anything up, you’ll always have a clean dataset to start again from. This is particularly important when loading in big dataframes, such as those from SQL.</p>
</div>
<p><br/></p>
</div>
<div id="basic-dataframe-functions" class="section level2">
<h2><span class="header-section-number">4.2</span> Basic dataframe functions</h2>
<p>There are a number of functions which can be used to gain a summary of data:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co">#Basic dataframe exploration functions</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw">summary</span>(swfc_<span class="dv">16</span>) <span class="co">#Get a summary of each variable</span></a></code></pre></div>
<div class="tip">
<p><b>Tip:</b>
This worksheet is built using an add on to R called R Markdown, which integrates code, text, and images. We’ll come on to how to create R Markdown documents later, but for now, the box below with a white background and grey border is an output from the above code as it renders in R Markdown. Remember this, it will appear a lot in the worksheet.</p>
</div>
<p><br/></p>
<pre><code>##    LA_Number     Establishment_Number  LAEstab_2016    
##  Min.   :201.0   Min.   :1000         Min.   :2013614  
##  1st Qu.:371.0   1st Qu.:2115         1st Qu.:3712144  
##  Median :850.0   Median :3001         Median :8502761  
##  Mean   :697.6   Mean   :3133         Mean   :6979196  
##  3rd Qu.:891.0   3rd Qu.:3605         3rd Qu.:8912352  
##  Max.   :938.0   Max.   :7750         Max.   :9387022  
##                                                        
##           LA_Name           URN        
##  Lancashire   :  632   Min.   :100000  
##  Kent         :  581   1st Qu.:110587  
##  Essex        :  556   Median :120528  
##  Hertfordshire:  535   Mean   :122340  
##  Hampshire    :  531   3rd Qu.:137029  
##  Birmingham   :  447   Max.   :143768  
##  (Other)      :18631                   
##                                School_Name   
##  St Joseph&#39;s Catholic Primary School :   57  
##  St Mary&#39;s Catholic Primary School   :   41  
##  St Anne&#39;s Catholic Primary School   :   20  
##  St Patrick&#39;s Catholic Primary School:   20  
##  Holy Family Catholic Primary School :   19  
##  St Peter&#39;s Catholic Primary School  :   18  
##  (Other)                             :21738</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">head</span>(swfc_<span class="dv">16</span>) <span class="co">#Get the top 6 rows</span></a></code></pre></div>
<pre><code>##   LA_Number Establishment_Number LAEstab_2016    LA_Name    URN
## 1       331                 4004      3314004   Coventry 141104
## 2       332                 2010      3322010     Dudley 103774
## 3       330                 4010      3304010 Birmingham 139788
## 4       332                 2012      3322012     Dudley 103775
## 5       332                 2043      3322043     Dudley 103781
## 6       210                 1025      2101025  Southwark 100768
##                           School_Name
## 1                         Seva School
## 2 Kates Hill Community Primary School
## 3             Waverley Studio College
## 4      Northfield Road Primary School
## 5         Dawley Brook Primary School
## 6          Ann Bernadt Nursery School</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">tail</span>(swfc_<span class="dv">16</span>) <span class="co">#Get the bottom 6 rows</span></a></code></pre></div>
<pre><code>##       LA_Number Establishment_Number LAEstab_2016         LA_Name    URN
## 21908       855                 2092      8552092  Leicestershire 143250
## 21909       831                 2424      8312424           Derby 112728
## 21910       882                 2105      8822105 Southend-on-Sea 143341
## 21911       936                 2269      9362269          Surrey 142433
## 21912       931                 2561      9312561     Oxfordshire 137992
## 21913       831                 1009      8311009           Derby 112475
##                          School_Name
## 21908       Newcroft Primary Academy
## 21909        Pear Tree Infant School
## 21910 Thorpe Greenways Infant School
## 21911      Lightwater Village School
## 21912        Faringdon Infant School
## 21913        Walbrook Nursery School</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">colnames</span>(swfc_<span class="dv">16</span>) <span class="co">#Get list of column names</span></a></code></pre></div>
<pre><code>##  [1] &quot;LA_Number&quot;                                                               
##  [2] &quot;Establishment_Number&quot;                                                    
##  [3] &quot;LAEstab_2016&quot;                                                            
##  [4] &quot;LA_Name&quot;                                                                 
##  [5] &quot;URN&quot;                                                                     
##  [6] &quot;School_Name&quot;                                                             
##  [7] &quot;School_Type_Description&quot;                                                 
##  [8] &quot;School_Type&quot;                                                             
##  [9] &quot;School_Phase&quot;                                                            
## [10] &quot;Religious_Character&quot;                                                     
## [11] &quot;Government_Office_Region_Name&quot;                                           
## [12] &quot;Parliamentary_Constituency&quot;                                              
## [13] &quot;LA_District&quot;                                                             
## [14] &quot;Ward&quot;                                                                    
## [15] &quot;StatutoryLowAge&quot;                                                         
## [16] &quot;StatutoryHighAge&quot;                                                        
## [17] &quot;Tot_Workforce_HC&quot;                                                        
## [18] &quot;Tot_Classroom_Teachers_HC&quot;                                               
## [19] &quot;Tot_Teachers_Leadership_HC&quot;                                              
## [20] &quot;Tot_Teachers_HC&quot;                                                         
## [21] &quot;Tot_TAs_HC&quot;                                                              
## [22] &quot;Tot_NonClassroom_Support_Staff_Exc_Aux_Staff_HC&quot;                         
## [23] &quot;Tot_Auxiliary_Staff_HC&quot;                                                  
## [24] &quot;Perc_PT_Teaching_Staff_&quot;                                                 
## [25] &quot;Tot_Workforce_FTE&quot;                                                       
## [26] &quot;Tot_Classroom_Teachers_FTE&quot;                                              
## [27] &quot;Tot_Teachers_Leadership_FTE&quot;                                             
## [28] &quot;Tot_Teachers_FTE&quot;                                                        
## [29] &quot;Tot_TAs_FTE&quot;                                                             
## [30] &quot;Tot_NonClassroom_Support_Staff_Exc_Aux_Staff_FTE&quot;                        
## [31] &quot;Tot_Aux_Staff_FTE&quot;                                                       
## [32] &quot;TA_Teacher_Ratio&quot;                                                        
## [33] &quot;Pupil_Teacher_Ratio&quot;                                                     
## [34] &quot;Perc_Male_Teachers&quot;                                                      
## [35] &quot;Perc_Minority_Ethnic_Teachers&quot;                                           
## [36] &quot;Perc_Over_Age_50_Teachers&quot;                                               
## [37] &quot;Perc_QTS_Teachers&quot;                                                       
## [38] &quot;Perc_of_Unqual_Teachers_who_Unqual_on_QTS_Route&quot;                         
## [39] &quot;Perc_Male_TAs&quot;                                                           
## [40] &quot;Perc_Minority_Ethnic_TAs&quot;                                                
## [41] &quot;Perc_HLTA_TAs&quot;                                                           
## [42] &quot;Perc_Male_Non_Classroom_Support_Staff&quot;                                   
## [43] &quot;Perc_Minority_Ethnic_Non_Classroom_Support_Staff&quot;                        
## [44] &quot;Perc_Male_Aux_Staff&quot;                                                     
## [45] &quot;Perc_Minority_Ethnic_Aux_Staff&quot;                                          
## [46] &quot;Regional_Pay_Spine&quot;                                                      
## [47] &quot;Mean_Gross_Salary_All_Teachers_Sterling&quot;                                 
## [48] &quot;Perc_Main_Pay_Range_Classroom_Teachers&quot;                                  
## [49] &quot;Perc_Upper_Pay_Range_Leading_Practioners_Pay_Range_Classroom_Teachers&quot;   
## [50] &quot;Perc_Receive_Allowance_Qual_Classroom_Teachers&quot;                          
## [51] &quot;Perc_Leadership_Pay_Range_Teachers&quot;                                      
## [52] &quot;Perc_At_Least_One_Sickness_Absence_Teachers&quot;                             
## [53] &quot;Tot_Days_Sickness_Absence&quot;                                               
## [54] &quot;Mean_Days_Lost_Teacher_Sickness_Absence_Of_Those_Taking_Sickness_Absence&quot;
## [55] &quot;Mean_Days_Lost_Teacher_Sickness_Absence_All_Teachers&quot;                    
## [56] &quot;FT_Vacant_Posts&quot;                                                         
## [57] &quot;Perc_FT_Posts_Vacant&quot;                                                    
## [58] &quot;FT_Temp_Filled_Posts&quot;                                                    
## [59] &quot;Perc_FT_Temp_Filled_Posts&quot;</code></pre>
<div class="tip">
<p><b>Tip:</b></p>
<p>Click on the name of a dataframe to open it in a new window.
Click on the arrow to the left of it to see the structure of it, or type <span class="code">str(DATAFRAME_NAME)<span class="code"></p>
</div>
<p><br/>s</p>
<p>We can also change column names using the above function:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co">#Identify the column number using colnames(swfc_16) and then specify the string to change it to</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="kw">colnames</span>(swfc_<span class="dv">16</span>)[<span class="dv">11</span>] &lt;-<span class="st"> &quot;Region&quot;</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3"></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="co">#...and change it back again</span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="kw">colnames</span>(swfc_<span class="dv">16</span>)[<span class="dv">11</span>] &lt;-<span class="st"> &quot;Government_Office_Region_Name&quot;</span></a></code></pre></div>
</div>
<div id="selecting-certain-columnsremoving-columns" class="section level2">
<h2><span class="header-section-number">4.3</span> Selecting certain columns/removing columns</h2>
<p>Selecting certain columns is really helpful for creating subset dataframes. Below we select the school’s LA Establishment Code, its unique identifier, and all the columns to do to do with teacher absences:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">teacher_absences &lt;-<span class="st"> </span>swfc_<span class="dv">16</span>[,<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">53</span><span class="op">:</span><span class="dv">55</span>)]</a></code></pre></div>
<p>Let’s break this down:</p>
<ol style="list-style-type: decimal">
<li><span class="code">teacher_absences</span> is the name of the new dataframe we’re going to create</li>
<li>We’ve seen the get sign before</li>
<li><span class="code">swfc_16</span> is the dataframe we’re going to select columns from</li>
<li><span class="code">[]</span> is for selecting a certain element from an object</li>
<li><span class="code">c()</span> stipulates a character string, in this instance a load of numbers</li>
<li><span class="code">x:y</span> means all numbers between and including x and y</li>
<li>The comma and nothing before it signifies that all rows must be included - the format is <span class="code">dataframe[row conditions, column conditions]</span></li>
</ol>
<p>Whilst we can use this method to remove columns, we can also remove individual columns using a simpler method. Say for instance we wanted to remove the 2016 LA Establishment Code, the third column:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">swfc_<span class="dv">16</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span>[,<span class="op">-</span><span class="dv">3</span>]</a></code></pre></div>
</div>
<div id="conditional-selections" class="section level2">
<h2><span class="header-section-number">4.4</span> Conditional Selections</h2>
<p>We can select subsets of dataframes based on certain conditions. There are a number of ways to do it, but this method uses functions in the basic R set of functions, known as ‘base R’:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="co">#Conditionally select primary schools</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2">swfc_<span class="dv">16</span>_pri &lt;-<span class="st"> </span>swfc_<span class="dv">16</span>[swfc_<span class="dv">16</span><span class="op">$</span>School_Phase <span class="op">==</span><span class="st"> &quot;Primary&quot;</span>,]</a></code></pre></div>
<p>Let’s break this down:</p>
<ol style="list-style-type: decimal">
<li><span class="code">swfc_16_pri</span> is the name of the new dataframe we’re going to create</li>
<li>We’ve seen the get sign before</li>
<li><span class="code">swfc_16</span> is the dataframe we’re going to conditionally select rows from</li>
<li><span class="code">[</span>] is for selecting a certain element from an object</li>
<li><span class="code">$</span> is for extracting an element by name, in this instance the <span class="code">School_Phase</span> column</li>
<li><span class="code">==“Primary”</span> signifies that rows must equal <span class="code">Primary</span></li>
<li>The comma and then nothing after it signifies that all columns must be included - the format is <span class="code">dataframe[row conditions, column conditions]</span></li>
</ol>
<div class="activity">
<p><b>Activity A5.1:</b> Use conditional selections to create a new dataframe which contains all schools whose school type is an academy. Open the dataframe to see what an academy is actually called in School_Type.</p>
</div>
<p><br/></p>
<div class="tip">
<p><b>Tip:</b></p>
<p>After typing the dollar sign when looking for dataframe column names, pause, and a dropdown list will appear.</p>
</div>
<p><br/></p>
<p>We can also use selections on numerical variables too:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">swfc_<span class="dv">16</span>_male &lt;-<span class="st"> </span>swfc_<span class="dv">16</span>[swfc_<span class="dv">16</span><span class="op">$</span>Perc_Male_Teachers <span class="op">&gt;</span><span class="st"> </span><span class="dv">50</span>,]</a></code></pre></div>
<p>However, we’re not limited to just one condition:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co">#Conditionally select schools where Pupil:Teacher Ratios are below 20 and above or equal to 10</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">swfc_<span class="dv">16</span>_ptr &lt;-<span class="st"> </span>swfc_<span class="dv">16</span>[(swfc_<span class="dv">16</span><span class="op">$</span>Pupil_Teacher_Ratio <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span> <span class="op">&amp;</span><span class="st"> </span>swfc_<span class="dv">16</span><span class="op">$</span>Pupil_Teacher_Ratio <span class="op">&gt;=</span><span class="dv">10</span>),]</a>
<a class="sourceLine" id="cb26-3" data-line-number="3"></a>
<a class="sourceLine" id="cb26-4" data-line-number="4"><span class="co">#Conditionally select schools where Pupil:Teacher Ratios are below 10 or their LA is in Camden</span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5">swfc_<span class="dv">16</span>_ptr_camden &lt;-<span class="st"> </span>swfc_<span class="dv">16</span>[(swfc_<span class="dv">16</span><span class="op">$</span>Pupil_Teacher_Ratio <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span> <span class="op">|</span><span class="st"> </span>swfc_<span class="dv">16</span><span class="op">$</span>LA_Name <span class="op">==</span><span class="st"> &quot;Camden&quot;</span>),]</a></code></pre></div>
<div class="activity">
<p><b>Activity A5.2:</b> Select all schools whose StatutoryLowAge is higher than 5 and have no full time posts vacant (the fourth from last column).</p>
</div>
<p><br/></p>
</div>
<div id="altering-data-in-dataframes" class="section level2">
<h2><span class="header-section-number">4.5</span> Altering data in dataframes</h2>
<p>Editing dataframes is a key skill. We can edit the data within columns, or create new ones.</p>
<p>Here we edit the <span class="code">Religious_Character</span> to be <span class="code">TRUE</span> or <span class="code">FALSE</span>. The <span class="code">Religious_Character</span> column is a column of factors - strings limited to a certain number of entries. We will first turn it into a column which can contain any string, called a character column.</p>
<div class="tip">
<p><b>Tip:</b></p>
<p>If a column is a factor, you can see what the different entries are through <span class="code">levels(dataframe$column)</span>.</p>
</div>
<p><br/></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co">#Turn Religious.Character to binary</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2">swfc_<span class="dv">16</span><span class="op">$</span>Religious_Character &lt;-<span class="st"> </span><span class="kw">as.character</span>(swfc_<span class="dv">16</span><span class="op">$</span>Religious_Character)</a>
<a class="sourceLine" id="cb27-3" data-line-number="3"></a>
<a class="sourceLine" id="cb27-4" data-line-number="4">swfc_<span class="dv">16</span><span class="op">$</span>Religious_Character[swfc_<span class="dv">16</span><span class="op">$</span>Religious_Character <span class="op">==</span><span class="st"> &#39;Does not apply&#39;</span> <span class="op">|</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="st">                              </span>swfc_<span class="dv">16</span><span class="op">$</span>Religious_Character <span class="op">==</span><span class="st"> &#39;None&#39;</span> <span class="op">|</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="st">                              </span>swfc_<span class="dv">16</span><span class="op">$</span>Religious_Character <span class="op">==</span><span class="st"> &quot;&quot;</span>] &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7">swfc_<span class="dv">16</span><span class="op">$</span>Religious_Character[swfc_<span class="dv">16</span><span class="op">$</span>Religious_Character <span class="op">!=</span><span class="st"> </span><span class="ot">FALSE</span>] &lt;-<span class="st"> </span><span class="ot">TRUE</span></a></code></pre></div>
<p>This uses boolean logic (<span class="code">TRUE</span> or <span class="code">FALSE</span>). It also uses <span class="code">!=</span> which means does not equal.</p>
<p>We can calculate a new column too. In this instance we’ll work out the percentage of teaching staff that are vacancies.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="co">#Calculate percentage of posts which are vacancies</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2">swfc_<span class="dv">16</span><span class="op">$</span>perc_vacancies &lt;-<span class="st"> </span>swfc_<span class="dv">16</span><span class="op">$</span>FT_Vacant_Posts<span class="op">/</span>swfc_<span class="dv">16</span><span class="op">$</span>Tot_Teachers_HC</a></code></pre></div>
<div class="activity">
<p><b>Activity A5.3:</b> Turn all schools which arent an LA maintained school or a special school into ‘Not LA maintained’.</p>
</div>
<p><br/></p>
</div>
<div id="writing-data" class="section level2">
<h2><span class="header-section-number">4.6</span> Writing data</h2>
<div class="activity">
<p><b>Activity A5.4:</b> The function for writing is <span class="code">write.csv()</span>. Use the help function (<span class="code">?write.csv</span>) to work out what the arguments are for this function</p>
</div>
<p><br/></p>

<p>#dplyr</p>
</div>
<div id="packages" class="section level2">
<h2><span class="header-section-number">4.7</span> Packages</h2>
<p>One of the great things about R (and lots of other open source programming languages) is that you can add in extra functionality really easy. These extra functions come in the form of packages.</p>
<p>To get a package, we first need to install it. This can be done in the console, as once installed, we don’t need to reinstall every time we start a new session of R.</p>
<p>We are going to install a package called <span class="code">dplyr</span>, a package to manipulate data.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<p>A lot of funny stuff will come up in your Console, ignore it, it’s all normal (or should be!).</p>
<p>Once we’ve installed it, we have to load the package. This we do have to do every time we start a new session of R.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="co">#Load required libraries</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a></code></pre></div>
</div>
<div id="the-pipe" class="section level2">
<h2><span class="header-section-number">4.8</span> The pipe</h2>
<p>The first feature we’ll look at is the pipe: <span class="code">%&gt;%</span>.</p>
<p>The pipe actually comes from a package which <span class="code">dplyr</span> is dependent on in order to run (these types of packages are called dependencies) called <span class="code">magrittr</span> and so is installed when <span class="code">dplyr</span> is installed. The pipe allows you turn code into the format of a recipe, carrying out a series of functions one after another. For example, we could turn the name of the school (<span class="code">School_Name</span>) into a character from a factor, as it is not a categorical variable where the records could take one of a fixed number of entries.</p>
<p>In base R, this would look like:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">swfc_<span class="dv">16</span><span class="op">$</span>School_Name &lt;-<span class="st"> </span><span class="kw">as.character</span>(swfc_<span class="dv">16</span><span class="op">$</span>School_Name)</a></code></pre></div>
<p>In <span class="code">dplyr</span> this looks like:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">swfc_<span class="dv">16</span><span class="op">$</span>School_Name &lt;-<span class="st"> </span>swfc_<span class="dv">16</span><span class="op">$</span>School_Name <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.character</span>()</a></code></pre></div>
<p>The pipe gives a more logical approach - putting the ingredients (<span class="code">swfc_16$Perc_Teachers_QTS</span>) into recipe steps. We don’t have to include arguments which specify which object we’re operating on, as this is specified when we input the ingredients.</p>
<div class="tip">
<p><b>Tip:</b></p>
<p>You can shortcut to a pipe by CTRL + SHIFT + M.</p>
</div>
</div>
<div id="joining" class="section level2">
<h2><span class="header-section-number">4.9</span> Joining</h2>
<p>There are a number of types of joins that <span class="code">dplyr</span> offers. We won’t go through them here as this isn’t what this course is about, but <a href="http://rstudio-pubs-static.s3.amazonaws.com/227171_618ebdce0b9d44f3af65700e833593db.html">this post</a> goes through them clearly. We will use a left join - keeping all rows on one dataframe, joining another on a certain variable where they match, and making all rows which don’t match ‘not applicable’.</p>
<p>We will create a dataframe which details whether a Government Office Region is in London or the Rest of England and then match it to the rest of the School Workforce Census.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="co">#Create dataframe on whether region is in London or Rest of England</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2">ldn_roe &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Government_Office_Region_Name =</span> <span class="kw">c</span>(<span class="st">&quot;East Midlands&quot;</span>, <span class="st">&quot;East of England&quot;</span>, <span class="st">&quot;Inner London&quot;</span>, </a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="st">&quot;North East&quot;</span>, <span class="st">&quot;North West&quot;</span>, <span class="st">&quot;Outer London&quot;</span>, <span class="st">&quot;South East&quot;</span>, <span class="st">&quot;South West&quot;</span>, <span class="st">&quot;West Midlands&quot;</span>, <span class="st">&quot;Yorkshire and the Humber&quot;</span>),</a>
<a class="sourceLine" id="cb33-4" data-line-number="4"><span class="dt">ldn_roe =</span> <span class="kw">c</span>(<span class="st">&quot;RoE&quot;</span>,<span class="st">&quot;RoE&quot;</span>,<span class="st">&quot;LDN&quot;</span>,<span class="st">&quot;RoE&quot;</span>,<span class="st">&quot;RoE&quot;</span>,<span class="st">&quot;LDN&quot;</span>,<span class="st">&quot;RoE&quot;</span>,<span class="st">&quot;RoE&quot;</span>,<span class="st">&quot;RoE&quot;</span>,<span class="st">&quot;RoE&quot;</span>))</a>
<a class="sourceLine" id="cb33-5" data-line-number="5"></a>
<a class="sourceLine" id="cb33-6" data-line-number="6"><span class="co">#Match to SWFC</span></a>
<a class="sourceLine" id="cb33-7" data-line-number="7">swfc_<span class="dv">16</span> &lt;-<span class="st"> </span><span class="kw">left_join</span>(swfc_<span class="dv">16</span>,LDN_RoE,<span class="dt">by=</span><span class="st">&quot;Government_Office_Region_Name&quot;</span>)</a></code></pre></div>
<p>We can also match on column names even if they columns are named differently. But first, we’ll remove the column that we’ve just added in using the ‘select’ function.</p>
</div>
<div id="selecting" class="section level2">
<h2><span class="header-section-number">4.10</span> Selecting</h2>
<p>The <span class="code">select</span> function uses column names to select subsets of a dataframe. Individual columns can be selected, separated by columns, or groups of columns, with the starting and ending columns separated by a colon.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="co">#Remove new column</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2">swfc_<span class="dv">16</span> &lt;-<span class="st"> </span><span class="kw">select</span>(swfc_<span class="dv">16</span>,LA_Number<span class="op">:</span>Perc_FT_Temp_Filled_Posts)</a>
<a class="sourceLine" id="cb34-3" data-line-number="3"></a>
<a class="sourceLine" id="cb34-4" data-line-number="4"><span class="co">#Or using &#39;the pipe&#39;</span></a>
<a class="sourceLine" id="cb34-5" data-line-number="5"></a>
<a class="sourceLine" id="cb34-6" data-line-number="6">swfc_<span class="dv">16</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb34-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(LA_Number<span class="op">:</span>Perc_FT_Temp_Filled_Posts)</a></code></pre></div>
<p>Now, we can change the name of the first <span class="code">ldn_roe</span> column, and then match again.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="co">#Change name of Government_Office_Region_Name</span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2">ldn_roe &lt;-<span class="st"> </span>ldn_roe <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(<span class="dt">Region =</span> Government_Office_Region_Name,</a>
<a class="sourceLine" id="cb35-4" data-line-number="4">          ldn_roe)</a>
<a class="sourceLine" id="cb35-5" data-line-number="5"></a>
<a class="sourceLine" id="cb35-6" data-line-number="6"><span class="co">#Match to SWFC</span></a>
<a class="sourceLine" id="cb35-7" data-line-number="7">swfc_<span class="dv">16</span> &lt;-<span class="st"> </span><span class="kw">left_join</span>(swfc_<span class="dv">16</span>,ldn_roe,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;Government_Office_Region_Name&quot;</span>=<span class="st">&quot;Region&quot;</span>))</a></code></pre></div>
</div>
<div id="pivoting" class="section level2">
<h2><span class="header-section-number">4.11</span> Pivoting</h2>
<p>Pivoting (grouping data by certain characteristics and then performing certain calculations - counts of each group or averages for each group) is a really popular feature in Excel, and can be replicated using <span class="code">dplyr</span>.</p>
<p>We’re going to create two pivot tables:</p>
<ul>
<li>Count the number of each type of school</li>
<li>Calculate the average % of teachers with Qualified Teacher Status for each school type</li>
</ul>
<p>The image below shows the boxes from the Excel pivot table user interface with the entries to build the pivot table for the first of the list above.</p>
<p><img src="www/Excel_Pivot.png" width="300"></img></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="co">#Calculate the number of schools by school type</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2">school_type_count &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#Set the name of the output object and feed in &#39;the ingredients&#39; - swfc_16 in this instance</span></a>
<a class="sourceLine" id="cb36-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(School_Type) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#Recipe step 1: Specifying the variable we want to group the data by</span></a>
<a class="sourceLine" id="cb36-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Count_Schools =</span> <span class="kw">n</span>()) <span class="co">#Recipe step 2: Define what function we want to apply to the grouped data. Here we are doing a simple count - n(). We also specify the name of the new column, in this instance &#39;Count_Schools&#39;</span></a></code></pre></div>
<div class="tip">
<p><b>Tip:</b></p>
<p>To prevent your lines of code being too long you can start new lines after things like <span class="code">%&gt;%</span>, <span class="code">,</span>, <span class="code">=</span>, and <span class="code">&lt;-</span>.</p>
<p>If you go to ‘Tools’, ‘Global Options’, ‘Code’, ‘Display’ there is an option called ‘Show margin’ which adds a margin after 80 characters as a default - try not to exceed this.</p>
</div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="co">#Calculate average percentage of qualified teachers per school, grouped by school type</span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2">av_qts_schooltype &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#Set the name of the output object and feed in &#39;the ingredients&#39; - swfc_16 in this instance</span></a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(School_Type) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#Recipe step 1: Specifying the variable we want to group the data by</span></a>
<a class="sourceLine" id="cb37-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Ave_Perc_QTS =</span> <span class="kw">mean</span>(Perc_QTS_Teachers,<span class="dt">na.rm=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb37-5" data-line-number="5">    <span class="co">#Recipe step 2: Calculate the average percentage of qualified teachers for each group. The &#39;na.rm=TRUE&#39; argument does not consider rows where the value is NA.</span></a></code></pre></div>
<div class="activity">
<b>Activity A6.1:</b> Calculate the total number of full time posts which are vacant, by Government Office Region, using the function <span class="code">sum(column,na.rm=TRUE)</span>. Remember to turn the full time posts column into a data type which can be summed.
</div>
</div>
<div id="filtering" class="section level2">
<h2><span class="header-section-number">4.12</span> Filtering</h2>
<p>When we looked at conditional selections earlier, we were essentially looking at a way of filtering data. There’s a neater way of doing this with <span class="code">dplyr</span>:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="co">#Select all schools in Inner and Outer London</span></a>
<a class="sourceLine" id="cb38-2" data-line-number="2">swfc_<span class="dv">16</span>_lon &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb38-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">&quot;London&quot;</span>,Government_Office_Region_Name)) <span class="co">#The filtering function is unsurprisingly called &#39;filter()&#39;</span></a>
<a class="sourceLine" id="cb38-4" data-line-number="4">    <span class="co">#Here, we&#39;re using a function called grepl, which finds all rows where the Government_Office_Region_Name column contains the string &#39;London&#39;.</span></a></code></pre></div>
<div class="activity">
<b>Activity A6.2:</b> Use <span class="code">!is.na()</span> to filter out all schools without a value for the percentage of teachers who are qualified. Explain what <span class="code">!is.na()</span> does.
</div>
</div>
<div id="mutating" class="section level2">
<h2><span class="header-section-number">4.13</span> Mutating</h2>
<p>The <span class="code">mutate()</span> function allows you to alter data in the dataframe, as we did a few sections ago. Let’s take the code above where we calculated the number of schools of each type of school, bolt on some more recipe steps, and calculate the percentage of schools in each group.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="co">#Calculate the percentage of schools by school type</span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2">school_type_count &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(School_Type) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Count_Schools =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb39-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Perc_Schools =</span> Count_Schools<span class="op">/</span><span class="kw">sum</span>(Count_Schools))</a></code></pre></div>
<p>Let’s break this down:</p>
<ol style="list-style-type: decimal">
<li>We’ve used the mutate function</li>
<li>We’ve created a new column called <span class="code">Perc_Schools</span></li>
<li><span class="code">Perc_Schools</span> equals the count for each school type, divided by the total number of schools, calculated using <span class="code">sum()</span></li>
</ol>
<p>We can also mutate a column without creating a new column:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="co">#Calculate the percentage of schools by school type</span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2">school_type_count &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(School_Type) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb40-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Count_Schools =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb40-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Perc_Schools =</span> Count_Schools<span class="op">/</span><span class="kw">sum</span>(Count_Schools)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb40-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Perc_Schools =</span> <span class="kw">round</span>(Perc_Schools<span class="op">*</span><span class="dv">100</span>,<span class="dv">1</span>)) <span class="co">#Multiply Perc_Schools by 100 to get a percentage, and round to 1 decimal place.</span></a></code></pre></div>
<div class="activity">
<p><b>Activity A6.3:</b> The big one - use <span class="code">dplyr</span> to find out what percentage of secondary school (not including all through school) teaching assistants the East of England has. These are the functions you’ll need to run:</p>
<ol style="list-style-type: decimal">
<li>A filter</li>
<li>Pivoting using a sum</li>
<li>Mutating</li>
<li>Filtering on ‘East of England’</li>
<li>Selecting the value column</li>
<li>Using <span class="code">as.numeric()</span> to return just one number</li>
</ol>
<p>Hint: Write each step of code, run it, check it works, and then add the next recipe step in.</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="general-coding.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="graphs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
