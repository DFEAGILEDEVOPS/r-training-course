<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Introduction to R at DfE</title>
  <meta name="description" content="This resource is an introduction to the R programming language. It can be used as standalone learning tool, or as part of training sessions.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Introduction to R at DfE" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This resource is an introduction to the R programming language. It can be used as standalone learning tool, or as part of training sessions." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introduction to R at DfE" />
  
  <meta name="twitter:description" content="This resource is an introduction to the R programming language. It can be used as standalone learning tool, or as part of training sessions." />
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="functions.html">
<link rel="next" href="r-markdown.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to R at DfE</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface and motivation</a></li>
<li class="chapter" data-level="1" data-path="getting-started-with-rstudio.html"><a href="getting-started-with-rstudio.html"><i class="fa fa-check"></i><b>1</b> Getting started with RStudio</a><ul>
<li class="chapter" data-level="1.1" data-path="getting-started-with-rstudio.html"><a href="getting-started-with-rstudio.html#opening-r-studio"><i class="fa fa-check"></i><b>1.1</b> Opening R Studio</a></li>
<li class="chapter" data-level="1.2" data-path="getting-started-with-rstudio.html"><a href="getting-started-with-rstudio.html#r-studio-layout"><i class="fa fa-check"></i><b>1.2</b> R Studio Layout</a></li>
<li class="chapter" data-level="1.3" data-path="getting-started-with-rstudio.html"><a href="getting-started-with-rstudio.html#setting-up-a-project"><i class="fa fa-check"></i><b>1.3</b> Setting up a project</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="downloading-data-for-tutorial.html"><a href="downloading-data-for-tutorial.html"><i class="fa fa-check"></i><b>2</b> Downloading data for tutorial</a></li>
<li class="chapter" data-level="3" data-path="general-coding.html"><a href="general-coding.html"><i class="fa fa-check"></i><b>3</b> General Coding</a><ul>
<li class="chapter" data-level="3.1" data-path="general-coding.html"><a href="general-coding.html#objects"><i class="fa fa-check"></i><b>3.1</b> Objects</a></li>
<li class="chapter" data-level="3.2" data-path="general-coding.html"><a href="general-coding.html#comments"><i class="fa fa-check"></i><b>3.2</b> Comments</a></li>
<li class="chapter" data-level="3.3" data-path="general-coding.html"><a href="general-coding.html#good-coding-practice"><i class="fa fa-check"></i><b>3.3</b> Good coding practice</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="loading-and-exploring-data.html"><a href="loading-and-exploring-data.html"><i class="fa fa-check"></i><b>4</b> Loading and exploring data</a><ul>
<li class="chapter" data-level="4.1" data-path="loading-and-exploring-data.html"><a href="loading-and-exploring-data.html#loading-in-data"><i class="fa fa-check"></i><b>4.1</b> Loading in data</a></li>
<li class="chapter" data-level="4.2" data-path="loading-and-exploring-data.html"><a href="loading-and-exploring-data.html#basic-dataframe-functions"><i class="fa fa-check"></i><b>4.2</b> Basic dataframe functions</a></li>
<li class="chapter" data-level="4.3" data-path="loading-and-exploring-data.html"><a href="loading-and-exploring-data.html#selecting-certain-columnsremoving-columns"><i class="fa fa-check"></i><b>4.3</b> Selecting certain columns/removing columns</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="manipulating-dataframes.html"><a href="manipulating-dataframes.html"><i class="fa fa-check"></i><b>5</b> Manipulating Dataframes</a><ul>
<li class="chapter" data-level="5.1" data-path="manipulating-dataframes.html"><a href="manipulating-dataframes.html#conditional-selections"><i class="fa fa-check"></i><b>5.1</b> Conditional Selections</a></li>
<li class="chapter" data-level="5.2" data-path="manipulating-dataframes.html"><a href="manipulating-dataframes.html#altering-data-in-dataframes"><i class="fa fa-check"></i><b>5.2</b> Altering data in dataframes</a></li>
<li class="chapter" data-level="5.3" data-path="manipulating-dataframes.html"><a href="manipulating-dataframes.html#writing-data"><i class="fa fa-check"></i><b>5.3</b> Writing data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html"><i class="fa fa-check"></i><b>6</b> Data manipulation with <strong><code>dplyr</code></strong></a><ul>
<li class="chapter" data-level="6.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#packages"><i class="fa fa-check"></i><b>6.1</b> Packages</a></li>
<li class="chapter" data-level="6.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#the-pipe"><i class="fa fa-check"></i><b>6.2</b> The pipe</a></li>
<li class="chapter" data-level="6.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#joining"><i class="fa fa-check"></i><b>6.3</b> Joining</a></li>
<li class="chapter" data-level="6.4" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#selecting"><i class="fa fa-check"></i><b>6.4</b> Selecting</a></li>
<li class="chapter" data-level="6.5" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#pivoting"><i class="fa fa-check"></i><b>6.5</b> Pivoting</a></li>
<li class="chapter" data-level="6.6" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#filtering"><i class="fa fa-check"></i><b>6.6</b> Filtering</a></li>
<li class="chapter" data-level="6.7" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#mutating"><i class="fa fa-check"></i><b>6.7</b> Mutating</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-visualisation-with-ggplot2.html"><a href="data-visualisation-with-ggplot2.html"><i class="fa fa-check"></i><b>7</b> Data visualisation with <strong><code>ggplot2</code></strong></a><ul>
<li class="chapter" data-level="7.1" data-path="data-visualisation-with-ggplot2.html"><a href="data-visualisation-with-ggplot2.html#ggplot2"><i class="fa fa-check"></i><b>7.1</b> ggplot2</a></li>
<li class="chapter" data-level="7.2" data-path="data-visualisation-with-ggplot2.html"><a href="data-visualisation-with-ggplot2.html#scatter-plots"><i class="fa fa-check"></i><b>7.2</b> Scatter plots</a></li>
<li class="chapter" data-level="7.3" data-path="data-visualisation-with-ggplot2.html"><a href="data-visualisation-with-ggplot2.html#bar-charts"><i class="fa fa-check"></i><b>7.3</b> Bar charts</a></li>
<li class="chapter" data-level="7.4" data-path="data-visualisation-with-ggplot2.html"><a href="data-visualisation-with-ggplot2.html#line-graphs"><i class="fa fa-check"></i><b>7.4</b> Line graphs</a></li>
<li class="chapter" data-level="7.5" data-path="data-visualisation-with-ggplot2.html"><a href="data-visualisation-with-ggplot2.html#displaying-a-third-variable"><i class="fa fa-check"></i><b>7.5</b> Displaying a third variable</a></li>
<li class="chapter" data-level="7.6" data-path="data-visualisation-with-ggplot2.html"><a href="data-visualisation-with-ggplot2.html#styles"><i class="fa fa-check"></i><b>7.6</b> Styles</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="statistical-operations.html"><a href="statistical-operations.html"><i class="fa fa-check"></i><b>8</b> Statistical operations</a><ul>
<li class="chapter" data-level="8.1" data-path="statistical-operations.html"><a href="statistical-operations.html#maximum-minimum-and-range"><i class="fa fa-check"></i><b>8.1</b> Maximum, Minimum, and Range</a></li>
<li class="chapter" data-level="8.2" data-path="statistical-operations.html"><a href="statistical-operations.html#averages"><i class="fa fa-check"></i><b>8.2</b> Averages</a></li>
<li class="chapter" data-level="8.3" data-path="statistical-operations.html"><a href="statistical-operations.html#correlations"><i class="fa fa-check"></i><b>8.3</b> Correlations</a></li>
<li class="chapter" data-level="8.4" data-path="statistical-operations.html"><a href="statistical-operations.html#significance-testing"><i class="fa fa-check"></i><b>8.4</b> Significance Testing</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="iteration.html"><a href="iteration.html"><i class="fa fa-check"></i><b>9</b> Iteration</a><ul>
<li class="chapter" data-level="9.1" data-path="iteration.html"><a href="iteration.html#if"><i class="fa fa-check"></i><b>9.1</b> if</a></li>
<li class="chapter" data-level="9.2" data-path="iteration.html"><a href="iteration.html#for-loops"><i class="fa fa-check"></i><b>9.2</b> for loops</a></li>
<li class="chapter" data-level="9.3" data-path="iteration.html"><a href="iteration.html#while-loops"><i class="fa fa-check"></i><b>9.3</b> while loops</a></li>
<li class="chapter" data-level="9.4" data-path="iteration.html"><a href="iteration.html#how-could-we-use-loops"><i class="fa fa-check"></i><b>9.4</b> How could we use loops?</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>10</b> Functions</a><ul>
<li class="chapter" data-level="10.1" data-path="functions.html"><a href="functions.html#writing-functions"><i class="fa fa-check"></i><b>10.1</b> Writing functions</a></li>
<li class="chapter" data-level="10.2" data-path="functions.html"><a href="functions.html#applying-functions-repetitively"><i class="fa fa-check"></i><b>10.2</b> Applying functions repetitively</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>11</b> Maps</a><ul>
<li class="chapter" data-level="11.1" data-path="maps.html"><a href="maps.html#loading-in-geospatial-data"><i class="fa fa-check"></i><b>11.1</b> Loading in geospatial data</a></li>
<li class="chapter" data-level="11.2" data-path="maps.html"><a href="maps.html#coordinate-systems"><i class="fa fa-check"></i><b>11.2</b> Coordinate systems</a></li>
<li class="chapter" data-level="11.3" data-path="maps.html"><a href="maps.html#transforming-mapping-data"><i class="fa fa-check"></i><b>11.3</b> Transforming mapping data</a></li>
<li class="chapter" data-level="11.4" data-path="maps.html"><a href="maps.html#point-maps"><i class="fa fa-check"></i><b>11.4</b> Point maps</a></li>
<li class="chapter" data-level="11.5" data-path="maps.html"><a href="maps.html#chloropleth-maps"><i class="fa fa-check"></i><b>11.5</b> Chloropleth maps</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>12</b> R Markdown</a><ul>
<li class="chapter" data-level="12.1" data-path="r-markdown.html"><a href="r-markdown.html#text"><i class="fa fa-check"></i><b>12.1</b> Text</a></li>
<li class="chapter" data-level="12.2" data-path="r-markdown.html"><a href="r-markdown.html#code"><i class="fa fa-check"></i><b>12.2</b> Code</a></li>
<li class="chapter" data-level="12.3" data-path="r-markdown.html"><a href="r-markdown.html#multiple-reports"><i class="fa fa-check"></i><b>12.3</b> Multiple Reports</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to R at DfE</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="maps" class="section level1">
<h1><span class="header-section-number">Chapter 11</span> Maps</h1>
<p>Maps in R are best plotted using <span class="code">ggplot</span> - which is good, because we already know how to use that! However, the new thing about maps is the sort of data we’ll be using - as well as having data about certain variables, this data has a location attached to it too.</p>
<p>First, we need to load in the packages we need. We’ll need the following packages:</p>
<ul>
<li><span class="code">tidyverse</span>, as this contains <span class="code">ggplot2</span> for plotting and <span class="code">dplyr</span> for data manipulation</li>
<li><span class="code">rgdal</span>, a package for loading in spatial data</li>
<li><span class="code">broom</span>, a package for converting spatial data into dataframes to be plotted in <span class="code">ggplot2</span></li>
</ul>
<div class="activity">
<p><b>Activity A11.1:</b></p>
<ol style="list-style-type: decimal">
<li>Install <span class="code">rgdal</span></li>
<li>Install <span class="code">broom</span></li>
<li>Use <span class="code">library()</span> to load <span class="code">tidyverse</span>, <span class="code">rgdal</span>, and <span class="code">broom</span></li>
</ol>
</div>
<br/>
<hr/>
<div id="loading-in-geospatial-data" class="section level2">
<h2><span class="header-section-number">11.1</span> Loading in geospatial data</h2>
<p>Geospatial data comes in three forms:</p>
<ul>
<li>Polygons (shapes)</li>
<li>Lines</li>
<li>Points</li>
</ul>
<p>Polygons and points are the most common (geospatial line data only really features when relating to travel infrastructure or people movements), so we’ll focus on these two.</p>
<p>Point, polygon, and line data can come in a number of different data formats, but the msot common is a ‘shapefile’ with a <span class="code">.shp</span> suffix. We can use the <span class="code">rgdal</span> library to load in shapefiles. Firstly, we’re going to load the names of location of major UK cities using the <span class="code">readOGR</span> function.</p>
<p>Make sure you have the shapefiles located in a folder called <span class="code">shps</span> within your <span class="code">data</span> folder first.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cities &lt;-<span class="st"> &quot;data/SHPs/england_cities.shp&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">readOGR</span>()</code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;C:\Users\tfranklin\OneDrive - Department for Education\Documents\Data Outputs\Git Repository\r-training-course\data\SHPs\england_cities.shp&quot;, layer: &quot;england_cities&quot;
## with 48 features
## It has 2 fields</code></pre>
<p>Plotted, the cities look like this:</p>
<p><img src="book_files/figure-html/sec11_2-1.png" width="672" /></p>
<p>…which looks vaguely like the UK!</p>
<p>You’ll see <span class="code">cities</span> is a <span class="code">SpatialPointsDataFrame</span> class object. The essentially means it’s a dataframe with spatial data attached.</p>
<div class="activity">
<p><b>Activity A11.2:</b> Click the blue circle to the left of <span class="code">cities</span> to open up the object. You’ll see there’s an attribute within <span class="code">cities</span> called <span class="code">data</span>, and another attribute called <span class="code">coords</span>.</p>
<p>Access these by typing <span class="code">cities@</span> and then whichever of the attributes you want to view.</p>
</div>
<p>We can also use <span class="code">readOGR</span> to load in polygon data. The file we’re going to use is one containing the boundaries of Local Authorities (LAs) in England, called <span class="code">England_LA_2016.shp</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">england &lt;-<span class="st"> &quot;data/SHPs/England_LA_2016.shp&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">readOGR</span>()</code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;C:\Users\tfranklin\OneDrive - Department for Education\Documents\Data Outputs\Git Repository\r-training-course\data\SHPs\England_LA_2016.shp&quot;, layer: &quot;England_LA_2016&quot;
## with 152 features
## It has 8 fields</code></pre>
<p>This is a <span class="code">SpatialPolygonsDataFrame</span>, which makes sense!</p>
<p>However, if we plot the LAs alongside the cities, the don’t match up.</p>
<p><img src="book_files/figure-html/sec11_4-1.png" width="672" /></p>
<pre><code>## integer(0)</code></pre>
<p>What we have here is all of the city points plotted down in the bottom lefthand corner (although you can only see one) over the LA map. This is because the cities data and the LA data use different ‘coordinate systems’.</p>
</div>
<div id="coordinate-systems" class="section level2">
<h2><span class="header-section-number">11.2</span> Coordinate systems</h2>
<p>At their most basic level, coordinates are just numbers that represent a location, where all the points within that set follow the same form. With that in mind, we can use different sets of numbers, or systems, to represent the location of a point. There are a lot of coordinate systems that are used in mapping, but the most common that you’ll come across when mapping UK data are:</p>
<ul>
<li>WGS84 (EPSG4326): This is the standard Latitude and Longitude coordinate system to map global data, developed in 1984. It makes the assumption that the earth is a perfect sphere (it’s actually a bit elliptical - wider at the sides), and Longitude (on the x axis) goes between -180 and 180 (degrees), with 0 being the Meridian Line in Greenwich, London. Latitude (on the y axis) again goes between -180 and 180, with 0 on the Equator.</li>
<li>OSGB36 (EPSG27700): This is a grid system, with units in metres, specific to the UK. It’s origin is about 100km west of Lands End, roughly level with the most southerly point of the mainland Britain, Lizard Point. It assumes that the British Isles are on a completely flat plane (which of course they aren’t). On the x axis are Eastings and on the y axis are Northings. The largest coordinate value is (800000,1300000).</li>
</ul>
<div class="tip">
<p><b>Tip:</b> The EPSG codes are codees from the now defunct European Petroleum Survey Group, and are a common code for different coordinate systems. These are the codes that we’ll use to change the coordinate systems. For more information on codes click <a href="http://www.epsg-registry.org/">here</a>.</p>
</div>
<p>Let’s check which coordinate systems <span class="code">cities</span> and <span class="code">england</span> are on.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Find out the coordinate system of cities</span>
cities<span class="op">@</span>proj4string</code></pre></div>
<pre><code>## CRS arguments:
##  +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0</code></pre>
<p>So, <span class="code">cities</span> is on WGS84 - we can see from its <span class="code">datum</span> (origin) attribute.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Find out the coordinate system of england</span>
england<span class="op">@</span>proj4string</code></pre></div>
<pre><code>## CRS arguments:
##  +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
## +y_0=-100000 +datum=OSGB36 +units=m +no_defs +ellps=airy
## +towgs84=446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894</code></pre>
<p>So, <span class="code">england</span> is on OSGB36 - again we can see from its <span class="code">datum</span> attribute.</p>
<p>Therefore, we need to translate one of the coordinate systems into the other. We’re going to convert <span class="code">cities</span> into the OSGB36 coordinate system, because it’s a bit more of an intuitive system to use, using a grid in metres instead of degrees.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cities &lt;-<span class="st"> </span>cities <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spTransform</span>(<span class="kw">CRS</span>(<span class="st">&quot;+init=epsg:27700&quot;</span>))</code></pre></div>
<p>Let’s break this down:</p>
<ul>
<li><span class="code">cities</span> is our object name, and the first ingredient in our ‘recipe’ using pipes. We’re essentially updating <span class="code">cities</span>.</li>
<li><span class="code">spTransform</span> is a function for transforming spatial objects’ coordinate systems</li>
<li><span class="code">CRS</span> stands for ‘Coordinate Reference System’ - this takes an argument which is a string containing the EPSG code of the coordinate system we want to convert to, which in this instance is EPSG27700</li>
</ul>
<div class="activity">
<p><b>Activity A11.1:</b> After you’ve run the code above, recheck which coordinate system <span class="code">cities</span> is on.</p>
</div>
<p>Now if we replot <span class="code">cities</span> and <span class="code">england</span>, we’ll see they line up more as we’d expect.</p>
<p><img src="book_files/figure-html/sec11_8-1.png" width="672" /></p>
<pre><code>## integer(0)</code></pre>
<br/>
<hr/>
</div>
<div id="transforming-mapping-data" class="section level2">
<h2><span class="header-section-number">11.3</span> Transforming mapping data</h2>
<p>As mentioned, we’re going to be using <span class="code">ggplot</span> to plot the maps. However, <span class="code">ggplot</span> takes dataframes, and currently we have spatial dataframes, so that’s not going to fly.</p>
<p>What we need to do is convert our spatial dataframes into normal dataframes. There are two methods for this:</p>
<ul>
<li>For point data we can just convert it straight to a normal dataframe, and select the coordinates and any other required columns (e.g. labels)</li>
<li>For polygon data we need to use a <span class="code">broom</span> function called <span class="code">tidy</span>, which breaks a polygon up into a series of lines, and creates a dataframe where each row is a coordinate of the start of one line and the stop of another, as well as a column detailing which group (in this instance a Local Authority) it’s part of</li>
</ul>
<p>Let’s deal with the point data first.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cities_df &lt;-<span class="st"> </span>cities <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#Create a dataframe (df) version of cities</span>
<span class="st">  </span><span class="kw">data.frame</span>() </code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cities_df &lt;-<span class="st"> </span>cities <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#Create a dataframe (df) version of cities</span>
<span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="dt">city=</span>City,
         <span class="dt">easting =</span> coords.x1,
         <span class="dt">northing =</span> coords.x2)</code></pre></div>
<p>Which creates something that looks like this:</p>
<pre><code>##         city  easting northing
## 1       Bath 374654.4 164546.7
## 2 Birmingham 405758.2 285421.0
## 3   Bradford 416570.4 431915.0
## 4   Brighton 531128.8 104856.1
## 5    Bristol 359560.8 172496.5
## 6  Cambridge 544754.9 257863.3</code></pre>
<div class="activity">
<p><b>Activity A11.2:</b> We need to do a bit of cleaning on this dataframe. Select only three columns, rename <span class="code">coords.x1</span> as <span class="code">easting</span> and <span class="code">coords.x2</span> as <span class="code">northing</span>.</p>
<p>With a polygon object, we can’t just use the <span class="code">data.frame</span> function, because unlike a point object, there are multiple coordinates associated with each item in the <span class="code">data</span> slot. So this is where we’re going to use <span class="code">tidy</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">england_df &lt;-<span class="st"> </span>england <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tidy</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as.tbl</span>() <span class="co">#We need this function to explicitly specify that that output is a dataframe</span></code></pre></div>
<p>Which leaves us with something that looks like this:</p>
<pre><code>## # A tibble: 6 x 7
##      long     lat order hole  piece group id   
##     &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;fct&gt; &lt;fct&gt; &lt;chr&gt;
## 1 447097. 537152.     1 FALSE 1     0.1   0    
## 2 447229. 537033.     2 FALSE 1     0.1   0    
## 3 447281. 537120.     3 FALSE 1     0.1   0    
## 4 447378. 537095.     4 FALSE 1     0.1   0    
## 5 447455. 537024.     5 FALSE 1     0.1   0    
## 6 447551. 537078.     6 FALSE 1     0.1   0</code></pre>
<p>There are a few things to notice about this dataframe:</p>
<ol style="list-style-type: decimal">
<li>The <span class="code">tidy</span> function, when applied to spatial objects, automatically names the coordinate columns <span class="code">long</span> and <span class="code">lat</span>. In this instance <span class="code">long</span> is actually <span class="code">easting</span> and <span class="code">lat</span> is actually <span class="code">northing</span> - we’ll change the names in a minute.</li>
<li>There are three defunct columns for our purposes: <span class="code">order</span>, <span class="code">hole</span>, and <span class="code">piece</span></li>
<li>There’s no identifier for a Local Authority (name or code), which is present in the <span class="code">data</span> slot of <span class="code">england</span>. This has been replaced by the <span class="code">id</span> column - each polygon’s points are identified by a unique number in that column.</li>
<li>When we plot this data, <span class="code">ggplot2</span> will initially plot each of these polygons as one continuous line. This means that if one polygon does not start (indicated by the <span class="code">order</span> column) at different coordinates to where the previous polygon finished, then a straight line across a polygon will appear (like the example below), connecting the two points. The <span class="code">group</span> column prevents this from happening by not linking polygons in different groups.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>england_df,
               <span class="kw">aes</span>(long,lat),
               <span class="dt">col=</span><span class="st">&quot;grey&quot;</span>,
               <span class="dt">fill=</span><span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.line=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.text.x=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.text.y=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.ticks=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.title.x=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.title.y=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.background=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.border=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.grid.major=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.grid.minor=</span><span class="kw">element_blank</span>(),
        <span class="dt">plot.background=</span><span class="kw">element_blank</span>(),
        <span class="dt">legend.title=</span><span class="kw">element_blank</span>())</code></pre></div>
<p><img src="book_files/figure-html/sec11_14-1.png" width="672" /></p>
<p>So, we need to create another dataframe which has all the data from <span class="code">england</span> as well as an <span class="code">id</span> column, to match to the dataframe that we’ve just created.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">england_data &lt;-<span class="st"> </span>england<span class="op">@</span>data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">cbind</span>(england_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(id) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>()) <span class="co">#Here we&#39;re binding the unique values from the id column in england_df to the data slot from england - the order remains the same which is why we can just bind them</span></code></pre></div>
<p>This dataframe looks like this:</p>
<pre><code>##      LA15CD               LA15NM LA_Code RSC_Code
## 0 E06000001           Hartlepool     805        5
## 1 E06000002        Middlesbrough     806        5
## 2 E06000003 Redcar and Cleveland     807        5
## 3 E06000004     Stockton-on-Tees     808        5
## 4 E06000005           Darlington     841        5
## 5 E06000006               Halton     876        8
##                      RSC_Name Reg_Code   RGN15CD    RGN15NM id
## 0                       North        9 E12000001 North East  0
## 1                       North        9 E12000001 North East  1
## 2                       North        9 E12000001 North East  2
## 3                       North        9 E12000001 North East  3
## 4                       North        9 E12000001 North East  4
## 5 Lancashire &amp; West Yorkshire        8 E12000002 North West  5</code></pre>
<div class="activity">
<p><b>Activity A11.3:</b> Match <span class="code">england_data</span> into <span class="code">england_df</span>, using <span class="code">id</span> and an inner join. Keep the following columns using <span class="code">select</span>: <span class="code">long</span> (renaming it <span class="code">easting</span>), <span class="code">lat</span> (renaming it <span class="code">northing</span>), <span class="code">LA15NM</span>, <span class="code">LA15CD</span>, and <span class="code">group</span>.</p>
</div>
The data is now in a format where we can get plotting! <br/>
<hr/>
</div>
<div id="point-maps" class="section level2">
<h2><span class="header-section-number">11.4</span> Point maps</h2>
<p>Point maps are useful where you want to show the location of entities with a single location, and attributes/values associated with that entity. In this example we’re going to map all schools within the Local Authority of Wiltshire, along with their phase and size.</p>
<p>First, we want to load in the data we’re going to be using. We’re going to load in the shapefile called <span class="code">wiltshire_schools</span> and transform it in one fell swoop.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wiltshire_schools_df &lt;-<span class="st"> &quot;data/shps/wiltshire_schools.shp&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">readOGR</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="dt">easting =</span> coords.x1,
         <span class="dt">northing =</span> coords.x2,
         LAEst<span class="op">:</span>P_FT_T)</code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;C:\Users\tfranklin\OneDrive - Department for Education\Documents\Data Outputs\Git Repository\r-training-course\data\SHPs\wiltshire_schools.shp&quot;, layer: &quot;wiltshire_schools&quot;
## with 231 features
## It has 53 fields</code></pre>
<div class="tip">
<b>Tip:</b> If you look at the dataframe, you’ll see the column names have been abbreviated - this is because shapefiles are limited to 8 characters for column names. However, we can refer to <span class="code">swfc_16_init</span> to work out what the column names are.
<div/>

<p>We can now finally plot some data!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>wiltshire_schools_df,<span class="kw">aes</span>(easting,northing))</code></pre></div>
<p><img src="book_files/figure-html/sec11_19-1.png" width="672" /></p>
<p>So, we’ve plotted some data, but it doesn’t look overly map like. Let’s break down what we’ve written first, and then we’ll make it look more like a map:</p>
<ol style="list-style-type: decimal">
<li><span class="code">ggplot()</span>: The standard function, but notice here it has no arguments. This is because <span class="code">ggplot2</span> also allows you to specify your data and aesthetics from within the type of plot you’re displaying. This is really useful when you’re plotting different types of graphs from different data sources on the same coordinate system.</li>
<li><span class="code">geom_point</span>: We’ve seen this before with scatter plots - it’s the same thing applied to spatial point data.</li>
<li><span class="code">data=wiltshire_schools_df</span>: This is the data we’re using, the quirk here is that when specifying data within the type of plot as opposed to from within <span class="code">ggplot</span> we need to explicitly specify the name of the argument, with <span class="code">data=</span>.</li>
<li><span class="code">aes(easting,northing)</span>: Standard aesthetics, plotting the Easting and Northing of each plot</li>
</ol>
<p>Now let’s makr it look more like a map. The first thing we can do is make the coordinates an equal scale (currently the x-axis is more stretched than the y-axis), and get rid of the grey background, the grid lines, and then axis labels.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>wiltshire_schools_df,<span class="kw">aes</span>(easting,northing)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.line=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.text=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.ticks=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.title=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.background=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.border=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.grid.major=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.grid.minor=</span><span class="kw">element_blank</span>(),
        <span class="dt">plot.background=</span><span class="kw">element_blank</span>())</code></pre></div>
<p><img src="book_files/figure-html/sec11_20-1.png" width="672" /></p>
<p>There’s a lot to specify in the <span class="code">theme</span> function, but once you’ve written it once you can copy it again and again (or even write a function to make it more concise/robust!).</p>
<p>That’s looking more map-like! What would really help is the border of Wiltshire. To do that we need to get a subset of <span class="code">england_df</span> which only contains coordinates which bound Wiltshire:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wiltshire_df &lt;-<span class="st"> </span>england_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(LA15NM <span class="op">==</span><span class="st"> &quot;Wiltshire&quot;</span>)</code></pre></div>
<p>We can then add a polygon to our map:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>wiltshire_df,<span class="kw">aes</span>(easting,northing),<span class="dt">col=</span><span class="st">&quot;grey&quot;</span>,<span class="dt">fill=</span><span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>wiltshire_schools_df,<span class="kw">aes</span>(easting,northing)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.line=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.text=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.ticks=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.title=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.background=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.border=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.grid.major=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.grid.minor=</span><span class="kw">element_blank</span>(),
        <span class="dt">plot.background=</span><span class="kw">element_blank</span>(),
        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="book_files/figure-html/sec11_22-1.png" width="672" /></p>
<p>That’s more like it! Let’s break down what we’ve got:</p>
<ol style="list-style-type: decimal">
<li><span class="code">geom_polygon</span>: This plots a polygon</li>
<li><span class="code">data=wiltshire_df,aes(easting,northing)</span>: We’ve seen this format before</li>
<li><span class="code">col=“grey”,fill=NA</span>: We want a grey outline and no fill colour</li>
</ol>
<p>Notice how we plot the polygon first - this is because <span class="code">ggplot2</span> builds up layers on top of each other, so we want the points on top of the polygon.</p>
<p>The final thing we need to do is add some attributes to the points. This uses the same arguments we’ve used in plotting graphs.</p>
<div class="activity">
<p><b>Activity A11.4:</b> Use <span class="code">col=</span> and <span class="code">size=</span> in the aesthetics in <span class="code">geom_point</span> to detail the phase of the school (column name <span class="code">Sch_P</span> in <span class="code">wiltshire_schools_df</span>) and the size of the school’s workforce (column name <span class="code">T_W_H</span> in <span class="code">wiltshire_schools_df</span>)</p>
</div>
<br/> <br/>
<div class="tip">
<p><b>Tip:</b> Add in <span class="code">legend.title = element_blank()</span> to get rid of the legend title and <span class="code">legend.key = element_rect(fill=NA)</span> to get rid of the grey backgrounds behind the legen - both just make it look a bit more professional!</p>
</div>
<br/>
<hr/>
</div>
<div id="chloropleth-maps" class="section level2">
<h2><span class="header-section-number">11.5</span> Chloropleth maps</h2>
<p>The other type of map that we’re going to look at are chloropleth maps. Chloropleth maps are maps of multiple polygons with each polygon filled in with a certain colour/hatching depending on a certain attribute/value.</p>
<p>A chloropleth map uses similar code to a point map. We’re going to plot a map which has the average total workforce for schools in each Local Authority on it.</p>
<p>However, the first thing we need to do is to attach data on the average school workforce for each Local Authority from <span class="code">swfc_16</span> to <span class="code">england_df</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">england_df &lt;-<span class="st"> </span>england_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inner_join</span>(swfc_<span class="dv">16</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(LA_Name) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">ave_tot_workforce =</span> <span class="kw">mean</span>(Tot_Workforce_HC,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)),<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;LA15NM&quot;</span>=<span class="st">&quot;LA_Name&quot;</span>))</code></pre></div>
<pre><code>## Warning: Column `LA15NM`/`LA_Name` joining factors with different levels,
## coercing to character vector</code></pre>
<p>This gives us a dataframe that looks like this:</p>
<pre><code>## # A tibble: 6 x 6
##   easting northing group LA15CD    LA15NM     ave_tot_workforce
##     &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;     &lt;chr&gt;                  &lt;dbl&gt;
## 1 447097.  537152. 0.1   E06000001 Hartlepool              67.2
## 2 447229.  537033. 0.1   E06000001 Hartlepool              67.2
## 3 447281.  537120. 0.1   E06000001 Hartlepool              67.2
## 4 447378.  537095. 0.1   E06000001 Hartlepool              67.2
## 5 447455.  537024. 0.1   E06000001 Hartlepool              67.2
## 6 447551.  537078. 0.1   E06000001 Hartlepool              67.2</code></pre>
<p>We can plot a simple chloropleth:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>england_df,
               <span class="kw">aes</span>(easting,northing,<span class="dt">group=</span>group,<span class="dt">fill=</span>ave_tot_workforce),
               <span class="dt">col=</span><span class="st">&quot;grey&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.line=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.text=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.ticks=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.title=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.background=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.border=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.grid.major=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.grid.minor=</span><span class="kw">element_blank</span>(),
        <span class="dt">plot.background=</span><span class="kw">element_blank</span>(),
        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="book_files/figure-html/sec11_25-1.png" width="672" /> The two key differences to a point map are:</p>
<ul>
<li>The use of the <span class="code">group</span> argument, to remove lines across polygons to connect them all</li>
<li>The use of the <span class="code">fill</span> argument with the <span class="code">ave_tot_workforce</span>, which fills each Local Authority polygon with a colour corresponding to its value</li>
</ul>
<p>The key thing that our chloropleth map is currently missing is some sort of reference to actual locations. However, we’ve got our city point data which we can add in, along with text labels. We have to build this up in two stages, so the first thing we’ll add in are the points:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>england_df,
               <span class="kw">aes</span>(easting,northing,<span class="dt">group=</span>group,<span class="dt">fill=</span>ave_tot_workforce),
               <span class="dt">col=</span><span class="st">&quot;grey&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>cities_df,
             <span class="kw">aes</span>(easting,northing),
             <span class="dt">col=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.line=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.text=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.ticks=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.title=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.background=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.border=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.grid.major=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.grid.minor=</span><span class="kw">element_blank</span>(),
        <span class="dt">plot.background=</span><span class="kw">element_blank</span>(),
        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="book_files/figure-html/sec11_26-1.png" width="672" /></p>
<p>So we’ve plotted the location of the cities, using <span class="code">geom_point</span>, which we’ve used before. To add the labels we need to use a new function however, called <span class="code">geom_text</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>england_df,
               <span class="kw">aes</span>(easting,northing,<span class="dt">group=</span>group,<span class="dt">fill=</span>ave_tot_workforce),
               <span class="dt">col=</span><span class="st">&quot;grey&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>cities_df,
             <span class="kw">aes</span>(easting,northing),
             <span class="dt">col=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data=</span>cities_df,
            <span class="kw">aes</span>(easting,northing,<span class="dt">label=</span>city),
            <span class="dt">check_overlap =</span> <span class="ot">TRUE</span>,
            <span class="dt">col=</span><span class="st">&quot;red&quot;</span>,
            <span class="dt">hjust =</span> <span class="fl">1.1</span>,
            <span class="dt">vjust=</span><span class="fl">0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.line=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.text=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.ticks=</span><span class="kw">element_blank</span>(),
        <span class="dt">axis.title=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.background=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.border=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.grid.major=</span><span class="kw">element_blank</span>(),
        <span class="dt">panel.grid.minor=</span><span class="kw">element_blank</span>(),
        <span class="dt">plot.background=</span><span class="kw">element_blank</span>(),
        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="book_files/figure-html/sec11_27-1.png" width="672" /></p>
<p>Let’s break <span class="code">geom_text</span> down:</p>
<ol style="list-style-type: decimal">
<li>We’ve seen <span class="code">data=</span> and the first two arguments of <span class="code">aes</span> before</li>
<li><span class="code">label=city</span> adds a text label of a certain value to the coordinates detailed in <span class="code">easting</span> and <span class="code">northing</span></li>
<li><span class="code">check_overlap = TRUE</span> checks if a each label overlaps with a previous label, and if it does, it won’t plot it. For example, ‘Bristol’ overlaps with ‘Bath’, so because Bristol comes after Bath, it isn’t plotted.</li>
<li><span class="code">col = “red”</span> makes the text colour red</li>
<li><span class="code">hjust = 1.1</span> and <span class="code">vjust=0.3</span> make adjustments to the horizontal and vertical position of the label in relation to the point. This has been done so that the label doesn’t sit right on top of the point.</li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="r-markdown.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
