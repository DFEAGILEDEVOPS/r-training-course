<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Introduction to R at DfE</title>
  <meta name="description" content="This resource is an introduction to the R programming language. It can be used as standalone learning tool, or as part of training sessions.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Introduction to R at DfE" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This resource is an introduction to the R programming language. It can be used as standalone learning tool, or as part of training sessions." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introduction to R at DfE" />
  
  <meta name="twitter:description" content="This resource is an introduction to the R programming language. It can be used as standalone learning tool, or as part of training sessions." />
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="loading-and-exploring-data.html">
<link rel="next" href="data-visualisation-with-ggplot2.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to R at DfE</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface and motivation</a></li>
<li class="chapter" data-level="1" data-path="getting-started-with-rstudio.html"><a href="getting-started-with-rstudio.html"><i class="fa fa-check"></i><b>1</b> Getting started with RStudio</a><ul>
<li class="chapter" data-level="1.1" data-path="getting-started-with-rstudio.html"><a href="getting-started-with-rstudio.html#opening-r-studio"><i class="fa fa-check"></i><b>1.1</b> Opening R Studio</a></li>
<li class="chapter" data-level="1.2" data-path="getting-started-with-rstudio.html"><a href="getting-started-with-rstudio.html#r-studio-layout"><i class="fa fa-check"></i><b>1.2</b> R Studio Layout</a></li>
<li class="chapter" data-level="1.3" data-path="getting-started-with-rstudio.html"><a href="getting-started-with-rstudio.html#setting-up-a-project"><i class="fa fa-check"></i><b>1.3</b> Setting up a project</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="downloading-data-for-tutorial.html"><a href="downloading-data-for-tutorial.html"><i class="fa fa-check"></i><b>2</b> Downloading data for tutorial</a></li>
<li class="chapter" data-level="3" data-path="general-coding.html"><a href="general-coding.html"><i class="fa fa-check"></i><b>3</b> General Coding</a><ul>
<li class="chapter" data-level="3.1" data-path="general-coding.html"><a href="general-coding.html#objects"><i class="fa fa-check"></i><b>3.1</b> Objects</a></li>
<li class="chapter" data-level="3.2" data-path="general-coding.html"><a href="general-coding.html#comments"><i class="fa fa-check"></i><b>3.2</b> Comments</a></li>
<li class="chapter" data-level="3.3" data-path="general-coding.html"><a href="general-coding.html#good-coding-practice"><i class="fa fa-check"></i><b>3.3</b> Good coding practice</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="loading-and-exploring-data.html"><a href="loading-and-exploring-data.html"><i class="fa fa-check"></i><b>4</b> Loading and exploring data</a><ul>
<li class="chapter" data-level="4.1" data-path="loading-and-exploring-data.html"><a href="loading-and-exploring-data.html#loading-in-data"><i class="fa fa-check"></i><b>4.1</b> Loading in data</a></li>
<li class="chapter" data-level="4.2" data-path="loading-and-exploring-data.html"><a href="loading-and-exploring-data.html#basic-dataframe-functions"><i class="fa fa-check"></i><b>4.2</b> Basic dataframe functions</a></li>
<li class="chapter" data-level="4.3" data-path="loading-and-exploring-data.html"><a href="loading-and-exploring-data.html#overview-of-variable-types"><i class="fa fa-check"></i><b>4.3</b> Overview of variable types</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html"><i class="fa fa-check"></i><b>5</b> Data manipulation with <strong><code>dplyr</code></strong></a><ul>
<li class="chapter" data-level="5.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#packages"><i class="fa fa-check"></i><b>5.1</b> Packages</a></li>
<li class="chapter" data-level="5.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#the-pipe"><i class="fa fa-check"></i><b>5.2</b> The pipe</a></li>
<li class="chapter" data-level="5.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#selecting-columns"><i class="fa fa-check"></i><b>5.3</b> Selecting columns</a></li>
<li class="chapter" data-level="5.4" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#renaming-columns"><i class="fa fa-check"></i><b>5.4</b> Renaming columns</a></li>
<li class="chapter" data-level="5.5" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#filtering-data"><i class="fa fa-check"></i><b>5.5</b> Filtering data</a></li>
<li class="chapter" data-level="5.6" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#arranging-data"><i class="fa fa-check"></i><b>5.6</b> Arranging data</a></li>
<li class="chapter" data-level="5.7" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#generating-new-columns"><i class="fa fa-check"></i><b>5.7</b> Generating new columns</a></li>
<li class="chapter" data-level="5.8" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#changing-variable-classes"><i class="fa fa-check"></i><b>5.8</b> Changing variable classes</a></li>
<li class="chapter" data-level="5.9" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#recoding-values-in-a-column"><i class="fa fa-check"></i><b>5.9</b> Recoding values in a column</a></li>
<li class="chapter" data-level="5.10" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#joining-data-together"><i class="fa fa-check"></i><b>5.10</b> Joining data together</a></li>
<li class="chapter" data-level="5.11" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#pivoting-data"><i class="fa fa-check"></i><b>5.11</b> Pivoting data</a></li>
<li class="chapter" data-level="5.12" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#more-advanced-exercises"><i class="fa fa-check"></i><b>5.12</b> More advanced exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-visualisation-with-ggplot2.html"><a href="data-visualisation-with-ggplot2.html"><i class="fa fa-check"></i><b>6</b> Data visualisation with <strong><code>ggplot2</code></strong></a><ul>
<li class="chapter" data-level="6.1" data-path="data-visualisation-with-ggplot2.html"><a href="data-visualisation-with-ggplot2.html#ggplot2"><i class="fa fa-check"></i><b>6.1</b> ggplot2</a></li>
<li class="chapter" data-level="6.2" data-path="data-visualisation-with-ggplot2.html"><a href="data-visualisation-with-ggplot2.html#scatter-plots"><i class="fa fa-check"></i><b>6.2</b> Scatter plots</a></li>
<li class="chapter" data-level="6.3" data-path="data-visualisation-with-ggplot2.html"><a href="data-visualisation-with-ggplot2.html#bar-charts"><i class="fa fa-check"></i><b>6.3</b> Bar charts</a></li>
<li class="chapter" data-level="6.4" data-path="data-visualisation-with-ggplot2.html"><a href="data-visualisation-with-ggplot2.html#line-graphs"><i class="fa fa-check"></i><b>6.4</b> Line graphs</a></li>
<li class="chapter" data-level="6.5" data-path="data-visualisation-with-ggplot2.html"><a href="data-visualisation-with-ggplot2.html#displaying-a-third-variable"><i class="fa fa-check"></i><b>6.5</b> Displaying a third variable</a></li>
<li class="chapter" data-level="6.6" data-path="data-visualisation-with-ggplot2.html"><a href="data-visualisation-with-ggplot2.html#styles"><i class="fa fa-check"></i><b>6.6</b> Styles</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="statistical-operations.html"><a href="statistical-operations.html"><i class="fa fa-check"></i><b>7</b> Statistical operations</a><ul>
<li class="chapter" data-level="7.1" data-path="statistical-operations.html"><a href="statistical-operations.html#maximum-minimum-and-range"><i class="fa fa-check"></i><b>7.1</b> Maximum, Minimum, and Range</a></li>
<li class="chapter" data-level="7.2" data-path="statistical-operations.html"><a href="statistical-operations.html#averages"><i class="fa fa-check"></i><b>7.2</b> Averages</a></li>
<li class="chapter" data-level="7.3" data-path="statistical-operations.html"><a href="statistical-operations.html#correlations"><i class="fa fa-check"></i><b>7.3</b> Correlations</a></li>
<li class="chapter" data-level="7.4" data-path="statistical-operations.html"><a href="statistical-operations.html#significance-testing"><i class="fa fa-check"></i><b>7.4</b> Significance Testing</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="iteration.html"><a href="iteration.html"><i class="fa fa-check"></i><b>8</b> Iteration</a><ul>
<li class="chapter" data-level="8.1" data-path="iteration.html"><a href="iteration.html#if"><i class="fa fa-check"></i><b>8.1</b> if</a></li>
<li class="chapter" data-level="8.2" data-path="iteration.html"><a href="iteration.html#for-loops"><i class="fa fa-check"></i><b>8.2</b> for loops</a></li>
<li class="chapter" data-level="8.3" data-path="iteration.html"><a href="iteration.html#while-loops"><i class="fa fa-check"></i><b>8.3</b> while loops</a></li>
<li class="chapter" data-level="8.4" data-path="iteration.html"><a href="iteration.html#how-could-we-use-loops"><i class="fa fa-check"></i><b>8.4</b> How could we use loops?</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>9</b> Functions</a><ul>
<li class="chapter" data-level="9.1" data-path="functions.html"><a href="functions.html#writing-functions"><i class="fa fa-check"></i><b>9.1</b> Writing functions</a></li>
<li class="chapter" data-level="9.2" data-path="functions.html"><a href="functions.html#applying-functions-repetitively"><i class="fa fa-check"></i><b>9.2</b> Applying functions repetitively</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>10</b> Maps</a><ul>
<li class="chapter" data-level="10.1" data-path="maps.html"><a href="maps.html#loading-in-geospatial-data"><i class="fa fa-check"></i><b>10.1</b> Loading in geospatial data</a></li>
<li class="chapter" data-level="10.2" data-path="maps.html"><a href="maps.html#coordinate-systems"><i class="fa fa-check"></i><b>10.2</b> Coordinate systems</a></li>
<li class="chapter" data-level="10.3" data-path="maps.html"><a href="maps.html#transforming-mapping-data"><i class="fa fa-check"></i><b>10.3</b> Transforming mapping data</a></li>
<li class="chapter" data-level="10.4" data-path="maps.html"><a href="maps.html#point-maps"><i class="fa fa-check"></i><b>10.4</b> Point maps</a></li>
<li class="chapter" data-level="10.5" data-path="maps.html"><a href="maps.html#chloropleth-maps"><i class="fa fa-check"></i><b>10.5</b> Chloropleth maps</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>11</b> R Markdown</a><ul>
<li class="chapter" data-level="11.1" data-path="r-markdown.html"><a href="r-markdown.html#text"><i class="fa fa-check"></i><b>11.1</b> Text</a></li>
<li class="chapter" data-level="11.2" data-path="r-markdown.html"><a href="r-markdown.html#code"><i class="fa fa-check"></i><b>11.2</b> Code</a></li>
<li class="chapter" data-level="11.3" data-path="r-markdown.html"><a href="r-markdown.html#multiple-reports"><i class="fa fa-check"></i><b>11.3</b> Multiple Reports</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to R at DfE</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-manipulation-with-dplyr" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Data manipulation with <strong><code>dplyr</code></strong></h1>
<div id="packages" class="section level2">
<h2><span class="header-section-number">5.1</span> Packages</h2>
<p>One of the great things about R (and lots of other open source programming languages) is that you can add in extra functionality really easy. These extra functions come in the form of packages.</p>
<p>To get a package, we first need to install it. This can be done in the console, as once installed, we don’t need to reinstall every time we start a new session of R.</p>
<p>We are going to install a package called <span class="code">dplyr</span>, a package to manipulate data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</code></pre></div>
<p>A lot of funny stuff will come up in your Console, ignore it, it’s all normal (or should be!).</p>
<p>Once we’ve installed it, we have to load the package. This we do have to do every time we start a new session of R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Load required library</span>
<span class="kw">library</span>(dplyr)</code></pre></div>
</div>
<div id="the-pipe" class="section level2">
<h2><span class="header-section-number">5.2</span> The pipe</h2>
<p>The first feature we’ll look at is the pipe: <span class="code">%&gt;%</span>. We take our data and then we pass it through the pipe, which in effect means the word ‘then’. We’ll then analyse our data in some way using one of the functions that comes from the <code>dplyr</code> package. This in effect looks like:</p>
<p><img src="www/R_dplyr_pipe.png" width="1000"></img></p>
<p>The way around the arrow goes doesn’t matter, it can be either way, so the below code…</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output_dataframe &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(LA_Name)</code></pre></div>
<p>…is equivalent to this code. For the purposes of consistency in this tutorial, we will be using the above style.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">swfc_<span class="dv">16</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(LA_Name) -&gt;<span class="st"> </span>output_dataframe</code></pre></div>
<div class="tip">
<p><b>Tip:</b></p>
<p>You can shortcut to a pipe by CTRL + SHIFT + M.</p>
</div>
</div>
<div id="selecting-columns" class="section level2">
<h2><span class="header-section-number">5.3</span> Selecting columns</h2>
<p>We may only be interested in a few of the variables in our dataframe. For example, in the <code>swfc_16</code> file, we have 59 variables, but we may be only interested in 2 of those for our analysis. We can use the <code>select</code> function from the <code>dplyr</code> package (once this is installed and loaded) to choose those.</p>
<p><strong>Select two columns from <code>swfc_16</code> dataframe</strong></p>
<p>Here we’ll take two variables <code>LA_Number</code> and <code>LA_Name</code> and store them in a new dataframe I’ve named <code>selected_variables_ex_1</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Select only LA_Number and LA_Name column</span>
selected_variables_ex_<span class="dv">1</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(LA_Number, LA_Name)</code></pre></div>
<p><strong>Select all columns bar the LA_Number and LA_Name columns using the minus sign</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Take all columns bar the LA_Number and LA_Name column</span>
selected_variables_ex_<span class="dv">2</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>LA_Number, <span class="op">-</span>LA_Name) </code></pre></div>
<p><strong>Selecting all columns that start with the word LA</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Take all columns that start with LA</span>
selected_variables_ex_<span class="dv">3</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;LA&quot;</span>))</code></pre></div>
<div class="activity">
<p><b>Activity A6.3:</b></p>
<ol style="list-style-type: decimal">
<li>Select the columns <code>School_Name</code> and <code>School_Type</code> and assign them to a dataframe.</li>
<li>Select the first three columns. Tip: use <code>1:3</code> inside the select function.</li>
</ol>
<p>Hint: Write each step of code, run it, check it works, and then add the next recipe step in.</p>
</div>
</div>
<div id="renaming-columns" class="section level2">
<h2><span class="header-section-number">5.4</span> Renaming columns</h2>
<p>We can rename columns with the dplyr <code>rename</code> function. Inside the fucntion, we’ll have two parts. We’ll have the name we’d like our column to be set equal to the name of the column we currently have.</p>
<p>E.g. if we’d like to change the column name in <code>swfc_16</code> from <code>LA_Name</code> to <code>local_authority</code>, we’d run:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Rename the LA_Name column to be local_authority</span>
renamed_data_ex_<span class="dv">1</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">local_authority =</span> LA_Name)</code></pre></div>
</div>
<div id="filtering-data" class="section level2">
<h2><span class="header-section-number">5.5</span> Filtering data</h2>
<p>If we only want specific data where a contain is met, we can use the dplyr <code>filter</code> function in our pipe.</p>
<p>To filter on things that are characters or factors, e.g. School Type’s that are Free Schools, we’d wrap them within speech marks such as “Free Schools”. For filtering on numeric values, we don’t need to do this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Select all free schools in the dataset only</span>
filtered_data_ex_<span class="dv">1</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(School_Type <span class="op">==</span><span class="st"> &quot;Free Schools&quot;</span>) </code></pre></div>
<p><strong>Note:</strong> here we used an == symbol. This evaluates the data to find School Type’s where they are equal to “Free Schools</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Select schools where more than half of teachers are male</span>
filtered_data_ex_<span class="dv">2</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Perc_Male_Teachers <span class="op">&gt;</span><span class="st"> </span><span class="dv">50</span>)</code></pre></div>
<p>To filter on multiple contiditions, we can use the <code>&amp;</code> (and) and <code>|</code> (or) symbols.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Select the data for free schools or special schools in the dataset only</span>
filtered_data_ex_<span class="dv">3</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(School_Type <span class="op">%in%</span><span class="st"> &quot;Free Schools&quot;</span> <span class="op">|</span><span class="st"> </span>School_Type <span class="op">==</span><span class="st"> &quot;Special schools&quot;</span>)</code></pre></div>
<p><strong>Question: What would happen if you ask to find schools that are Free Schools and are also Special Schools?</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Select the data for schools that are free schools and special schools at the same time </span>
filtered_data_ex_<span class="dv">3</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(School_Type <span class="op">==</span><span class="st"> &quot;Free Schools&quot;</span> <span class="op">&amp;</span><span class="st"> </span>School_Type <span class="op">==</span><span class="st"> &quot;Special schools&quot;</span>)</code></pre></div>
<div class="activity">
<p><b>Activity A6.2:</b></p>
<ol style="list-style-type: decimal">
<li>Filter where <code>LA_Name</code> is “Wigan” and <code>Tot_Days_Sickness_Absence</code> is greater than 50.</li>
<li>Use <span class="code">!is.na()</span> to filter out all schools without a value for the percentage of teachers who are qualified. Explain what <span class="code">!is.na()</span> does.</li>
</ol>
</div>
</div>
<div id="arranging-data" class="section level2">
<h2><span class="header-section-number">5.6</span> Arranging data</h2>
<p>To order data from low to high by a column, we can use the dplyr <code>arrange</code> function. It by default arranges columns from low to high, e.g:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Arrange data by total workforce from low to high</span>
arranged_data_ex_<span class="dv">1</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(Tot_Workforce_HC)</code></pre></div>
<p>But wrapping the column around the <code>desc</code> function which stands for descending order, we can order from high to low, e.g:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Arrange data by total workforce from high to low</span>
arranged_data_ex_<span class="dv">2</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Tot_Workforce_HC)</code></pre></div>
</div>
<div id="generating-new-columns" class="section level2">
<h2><span class="header-section-number">5.7</span> Generating new columns</h2>
<p>When we make new columns in dplyr, we use the <code>mutate</code> function. We have two columns in the data, one that’s called <code>StatutoryHighAge</code> and another called <code>StatutoryLowAge</code>. These are the highest and lowest ages of pupils in a school. We can find the range of the ages of pupils in each school by running:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Select the data for schools that are free schools and special schools at the same time </span>
added_column_ex_<span class="dv">1</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_range_school =</span> StatutoryHighAge <span class="op">-</span><span class="st"> </span>StatutoryLowAge)</code></pre></div>
<p>Note that the dataframe <code>added_column_ex_1</code> now has 60 columns and we can check that this column makes sense by just looking at the following columns</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Check the new column makes sense by visually checking </span>
added_column_ex_<span class="dv">1</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(StatutoryLowAge, StatutoryHighAge, age_range_school)</code></pre></div>
</div>
<div id="changing-variable-classes" class="section level2">
<h2><span class="header-section-number">5.8</span> Changing variable classes</h2>
<p>From chapter 4, we discussed the different variable classes, such as characters and factors. We can use the <code>mutate</code> function to do this for us.</p>
<p>For example, if we’d like to change the <code>School_Name</code> column from being a factor to a character, we can run:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Check the new column makes sense by visually checking </span>
variable_class_ex_<span class="dv">1</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">School_Name =</span> <span class="kw">as.character</span>(School_Name))</code></pre></div>
</div>
<div id="recoding-values-in-a-column" class="section level2">
<h2><span class="header-section-number">5.9</span> Recoding values in a column</h2>
<p>In a column, we may have values that we’d like to change. E.g. within the School Type column we have possible values such as <code>Academies</code> and <code>LA maintained schools</code>. We may want to change <code>Academies</code> to be <code>Academy schools</code> and we can do that with a combination of the <code>mutate</code> function and the <code>recode</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Check the new column makes sense by visually checking </span>
recoded_ex_<span class="dv">1</span> &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span>
<span class="st">     </span><span class="kw">mutate</span>(<span class="dt">School_Type =</span> <span class="kw">recode</span>(School_Type, <span class="dt">Academies =</span> <span class="st">&quot;Academy schools&quot;</span>))</code></pre></div>
</div>
<div id="joining-data-together" class="section level2">
<h2><span class="header-section-number">5.10</span> Joining data together</h2>
<p>There are a number of types of joins that <span class="code">dplyr</span> offers. We won’t go through them here as this isn’t what this course is about, but <a href="http://rstudio-pubs-static.s3.amazonaws.com/227171_618ebdce0b9d44f3af65700e833593db.html">this post</a> goes through them clearly. We will use a left join - keeping all rows on one dataframe, joining another on a certain variable where they match, and making all rows which don’t match ‘not applicable’.</p>
<p>We will create a dataframe which details whether a Government Office Region is in London or the Rest of England and then match it to the rest of the School Workforce Census. Just copy and paste the code below to make a lookup dataframe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Create dataframe on whether region is in London or Rest of England</span>
ldn_roe &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Government_Office_Region_Name =</span> <span class="kw">c</span>(<span class="st">&quot;East Midlands&quot;</span>, <span class="st">&quot;East of England&quot;</span>, 
                                                        <span class="st">&quot;Inner London&quot;</span>, <span class="st">&quot;North East&quot;</span>, 
                                                        <span class="st">&quot;North West&quot;</span>, <span class="st">&quot;Outer London&quot;</span>, 
                                                        <span class="st">&quot;South East&quot;</span>, <span class="st">&quot;South West&quot;</span>, 
                                                        <span class="st">&quot;West Midlands&quot;</span>, <span class="st">&quot;Yorkshire and the Humber&quot;</span>),
                      <span class="dt">ldn_roe =</span> <span class="kw">c</span>(<span class="st">&quot;RoE&quot;</span>,<span class="st">&quot;RoE&quot;</span>,<span class="st">&quot;LDN&quot;</span>,<span class="st">&quot;RoE&quot;</span>,<span class="st">&quot;RoE&quot;</span>,<span class="st">&quot;LDN&quot;</span>,<span class="st">&quot;RoE&quot;</span>,<span class="st">&quot;RoE&quot;</span>,<span class="st">&quot;RoE&quot;</span>,<span class="st">&quot;RoE&quot;</span>))</code></pre></div>
<p>Now we have this lookup dataframe called <code>ldn_roe</code> we can now left join this onto our <code>swfc_16</code> dataframe by the common identifier between the two datasets called <code>Government_Office_Region_Name</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Match to SWFC</span>
swfc_<span class="dv">16</span> &lt;-<span class="st"> </span><span class="kw">left_join</span>(swfc_<span class="dv">16</span>,LDN_RoE,<span class="dt">by=</span><span class="st">&quot;Government_Office_Region_Name&quot;</span>)</code></pre></div>
<p><strong>Note: We can also match on column names even if they columns are named differently.</strong></p>
</div>
<div id="pivoting-data" class="section level2">
<h2><span class="header-section-number">5.11</span> Pivoting data</h2>
<p>Pivoting (grouping data by certain characteristics and then performing certain calculations - counts of each group or averages for each group) is a really popular feature in Excel, and can be replicated using <span class="code">dplyr</span>.</p>
<p>We’re going to create two pivot tables:</p>
<ul>
<li>Count the number of each type of school</li>
<li>Calculate the average % of teachers with Qualified Teacher Status for each school type</li>
</ul>
<p>The image below shows the boxes from the Excel pivot table user interface with the entries to build the pivot table for the first of the list above.</p>
<p><img src="www/Excel_Pivot.png" width="300"></img></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Calculate the number of schools by school type</span>
school_type_count &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#Set the name of the output object and feed in &#39;the ingredients&#39; - swfc_16 in this instance</span>
<span class="st">  </span><span class="kw">group_by</span>(School_Type) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#Recipe step 1: Specifying the variable we want to group the data by</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Count_Schools =</span> <span class="kw">n</span>()) <span class="co">#Recipe step 2: Define what function we want to apply to the grouped data. Here we are doing a simple count - n(). We also specify the name of the new column, in this instance &#39;Count_Schools&#39;</span></code></pre></div>
<div class="tip">
<p><b>Tip:</b></p>
<p>To prevent your lines of code being too long you can start new lines after things like <span class="code">%&gt;%</span>, <span class="code">,</span>, <span class="code">=</span>, and <span class="code">&lt;-</span>.</p>
<p>If you go to ‘Tools’, ‘Global Options’, ‘Code’, ‘Display’ there is an option called ‘Show margin’ which adds a margin after 80 characters as a default - try not to exceed this.</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Calculate average percentage of qualified teachers per school, grouped by school type</span>
av_qts_schooltype &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#Set the name of the output object and feed in &#39;the ingredients&#39; - swfc_16 in this instance</span>
<span class="st">  </span><span class="kw">group_by</span>(School_Type) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#Recipe step 1: Specifying the variable we want to group the data by</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Ave_Perc_QTS =</span> <span class="kw">mean</span>(Perc_QTS_Teachers,<span class="dt">na.rm=</span><span class="ot">TRUE</span>))
    <span class="co">#Recipe step 2: Calculate the average percentage of qualified teachers for each group. The &#39;na.rm=TRUE&#39; argument does not consider rows where the value is NA.</span></code></pre></div>
<div class="activity">
<b>Activity A6.1:</b> Calculate the total number of full time posts which are vacant, by Government Office Region, using the function <span class="code">sum(column,na.rm=TRUE)</span>. Remember to turn the full time posts column into a data type which can be summed.
</div>
</div>
<div id="more-advanced-exercises" class="section level2">
<h2><span class="header-section-number">5.12</span> More advanced exercises</h2>
<p>As we learned earlier, the <code>mutate</code> function allows you to alter data in the dataframe, as we did a few sections ago. Let’s take the code above where we calculated the number of schools of each type of school, bolt on some more recipe steps, and calculate the percentage of schools in each group.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Calculate the percentage of schools by school type</span>
school_type_count &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(School_Type) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Count_Schools =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Perc_Schools =</span> Count_Schools<span class="op">/</span><span class="kw">sum</span>(Count_Schools))</code></pre></div>
<p>Let’s break this down:</p>
<ol style="list-style-type: decimal">
<li>We’ve used the mutate function</li>
<li>We’ve created a new column called <span class="code">Perc_Schools</span></li>
<li><span class="code">Perc_Schools</span> equals the count for each school type, divided by the total number of schools, calculated using <span class="code">sum()</span></li>
</ol>
<p>We can also mutate a column without creating a new column:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Calculate the percentage of schools by school type</span>
school_type_count &lt;-<span class="st"> </span>swfc_<span class="dv">16</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(School_Type) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Count_Schools =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Perc_Schools =</span> Count_Schools<span class="op">/</span><span class="kw">sum</span>(Count_Schools)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Perc_Schools =</span> <span class="kw">round</span>(Perc_Schools<span class="op">*</span><span class="dv">100</span>,<span class="dv">1</span>)) <span class="co">#Multiply Perc_Schools by 100 to get a percentage, and round to 1 decimal place.</span></code></pre></div>
<div class="activity">
<p><b>Activity A6.3:</b> The big one - use <span class="code">dplyr</span> to find out what percentage of secondary school (not including all through school) teaching assistants the East of England has. These are the functions you’ll need to run:</p>
<ol style="list-style-type: decimal">
<li>A filter</li>
<li>Pivoting using a sum</li>
<li>Mutating</li>
<li>Filtering on ‘East of England’</li>
<li>Selecting the value column</li>
<li>Using <span class="code">as.numeric()</span> to return just one number</li>
</ol>
<p>Hint: Write each step of code, run it, check it works, and then add the next recipe step in.</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="loading-and-exploring-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-visualisation-with-ggplot2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
