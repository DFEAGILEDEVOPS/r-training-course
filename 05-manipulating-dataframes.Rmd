# Manipulating Dataframes

## Conditional Selections

We can select subsets of dataframes based on certain conditions. There are a number of ways to do it, but this method uses functions in the basic R set of functions, known as 'base R':

```{r sec5_1}
#Conditionally select primary schools
swfc_16_pri <- swfc_16[swfc_16$School_Phase == "Primary",]
```

Let's break this down:

1. <span class="code">swfc_16_pri</span> is the name of the new dataframe we're going to create
2. We've seen the get sign before
3. <span class="code">swfc_16</span> is the dataframe we're going to conditionally select rows from
4. <span class="code">[</span>] is for selecting a certain element from an object
5. <span class="code">$</span> is for extracting an element by name, in this instance the <span class="code">School_Phase</span> column
6. <span class="code">=="Primary"</span> signifies that rows must equal <span class="code">Primary</span>
7. The comma and then nothing after it signifies that all columns must be included - the format is <span class="code">dataframe[row conditions, column conditions]</span>

<div class="activity"><b>Activity A5.1:</b> Use conditional selections to create a new dataframe which contains all schools whose school type is an academy. Open the dataframe to see what an academy is actually called in School_Type.
</div>
<br/>

<div class="tip"><b>Tip:</b>

After typing the dollar sign when looking for dataframe column names, pause, and a dropdown list will appear.
</div>
<br/>

We can also use selections on numerical variables too:
```{r sec5_2}
swfc_16_male <- swfc_16[swfc_16$Perc_Male_Teachers > 50,]
```

However, we're not limited to just one condition:
```{r sec5_3}
#Conditionally select schools where Pupil:Teacher Ratios are below 20 and above or equal to 10
swfc_16_ptr <- swfc_16[(swfc_16$Pupil_Teacher_Ratio < 20 & swfc_16$Pupil_Teacher_Ratio >=10),]

#Conditionally select schools where Pupil:Teacher Ratios are below 10 or their LA is in Camden
swfc_16_ptr_camden <- swfc_16[(swfc_16$Pupil_Teacher_Ratio < 10 | swfc_16$LA_Name == "Camden"),]
```

<div class="activity"><b>Activity A5.2:</b> Select all schools whose StatutoryLowAge is higher than 5 and have no full time posts vacant (the fourth from last column).
</div>
<br/>

## Altering data in dataframes

Editing dataframes is a key skill. We can edit the data within columns, or create new ones.

Here we edit the <span class="code">Religious_Character</span> to be <span class="code">TRUE</span> or <span class="code">FALSE</span>. The <span class="code">Religious_Character</span> column is a column of factors - strings limited to a certain number of entries. We will first turn it into a column which can contain any string, called a character column.

<div class="tip"><b>Tip:</b>

If a column is a factor, you can see what the different entries are through <span class="code">levels(dataframe$column)</span>.
</div>
<br/>

```{r sec5_4}
#Turn Religious.Character to binary
swfc_16$Religious_Character <- as.character(swfc_16$Religious_Character)

swfc_16$Religious_Character[swfc_16$Religious_Character == 'Does not apply' |
                              swfc_16$Religious_Character == 'None' |
                              swfc_16$Religious_Character == ""] <- FALSE
swfc_16$Religious_Character[swfc_16$Religious_Character != FALSE] <- TRUE
```

This uses boolean logic (<span class="code">TRUE</span> or <span class="code">FALSE</span>). It also uses <span class="code">!=</span> which means does not equal.

We can calculate a new column too. In this instance we'll work out the percentage of teaching staff that are vacancies.

```{r sec5_5}
#Calculate percentage of posts which are vacancies
swfc_16$perc_vacancies <- swfc_16$FT_Vacant_Posts/swfc_16$Tot_Teachers_HC
```

<div class="activity"><b>Activity A5.3:</b> Turn all schools which arent an LA maintained school or a special school into 'Not LA maintained'.
</div>
<br/>

## Writing data

<div class="activity"><b>Activity A5.4:</b> The function for writing is <span class="code">write.csv()</span>. Use the help function (<span class="code">?write.csv</span>) to work out what the arguments are for this function
</div>
<br/>
